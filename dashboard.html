<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>7SIM - 专业接码服务平台</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- 添加 Firebase 库 -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <script>
        // 使用和 index.html 相同的 Firebase 配置
        const firebaseConfig = {
            apiKey: "AIzaSyAKcWEdi_Zd-CAJYtEiwkbNNs7ibOp6HG4",
            authDomain: "sim-platform-fa8dd.firebaseapp.com",
            projectId: "sim-platform-fa8dd",
            storageBucket: "sim-platform-fa8dd.firebasestorage.app",
            messagingSenderId: "276606433877",
            appId: "1:276606433877:web:ac217c829ffdc735fff2dc"
        };
        // 初始化 Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
    </script>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --success: #4bb543;
            --danger: #e74c3c;
            --warning: #ff9800;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --light-gray: #e9ecef;
        }
        
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
        }
        
        body { 
            background: #f5f7fb; 
            color: var(--dark); 
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        
        .container { 
            max-width: 1400px; 
            margin: 0 auto; 
            padding: 0 20px; 
        }
        
        /* 导航栏 */
        header { 
            background: white; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
            position: sticky; 
            top: 0; 
            z-index: 100; 
        }
        
        .navbar { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 15px 0; 
        }
        
        .logo { 
            font-size: 1.5rem; 
            font-weight: 700; 
            color: var(--primary); 
            text-decoration: none;
            display: flex;
            align-items: center;
        }
        
        .logo i {
            margin-right: 8px;
        }
        
        .nav-links {
            display: flex;
            gap: 30px;
        }
        
        .nav-links a {
            color: var(--dark);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }
        
        .nav-links a:hover {
            color: var(--primary);
        }
        
        .wallet-info { 
            display: flex; 
            align-items: center; 
            background: var(--light); 
            padding: 8px 15px; 
            border-radius: 20px; 
            margin-right: 15px; 
            font-weight: 500;
        }
        
        .btn { 
            padding: 8px 20px; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            font-weight: 500; 
            transition: all 0.3s;
        }
        
        .btn-primary { 
            background: var(--primary); 
            color: white; 
        }
        
        .btn-primary:hover {
            background: var(--secondary);
        }
        
        .btn-outline {
            background: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
        }
        
        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-success:hover {
            background: #3d9a36;
        }
        
        /* 主布局 */
        .dashboard-layout {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            min-height: calc(100vh - 100px);
        }
        
        .left-panel {
            width: 350px;
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            height: fit-content;
            position: sticky;
    top: 100px; /* 根据导航栏高度调整，确保在导航栏下方 */
    max-height: calc(100vh - 120px); /* 限制最大高度 */
    overflow-y: auto; /* 如果内容超出，允许滚动 */
        }
        
        .right-panel {
            flex: 1;
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
        }
        
        .panel-section {
            margin-bottom: 25px;
        }
        
        .panel-section h3 {
            margin-bottom: 15px;
            font-size: 1.1rem;
            color: var(--dark);
            padding-bottom: 8px;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .search-bar {
            position: relative;
            margin-bottom: 15px;
        }
        
        .search-bar i {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }
        
        .search-bar input {
            width: 100%;
            padding: 10px 10px 10px 35px;
            border: 1px solid var(--light-gray);
            border-radius: 4px;
            font-size: 0.9rem;
        }
        
        /* 已选择项样式 */
        .selected-item {
            display: flex;
            align-items: center;
            background: var(--light);
            padding: 10px 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }
        
        .selected-item-content {
            flex: 1;
            display: flex;
            align-items: center;
        }
        
        .selected-item-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            color: var(--primary);
            font-size: 1.2rem;
        }
        
        .selected-item-name {
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .remove-selection {
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            font-size: 1.2rem;
            padding: 5px;
            border-radius: 4px;
        }
        
        .remove-selection:hover {
            color: var(--danger);
            background: rgba(231, 76, 60, 0.1);
        }
        
        /* 服务列表 */
        .services-list, .countries-list, .operators-list {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
        }
        
        .service-item, .country-item, .operator-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            border-bottom: 1px solid var(--light-gray);
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .service-item:hover, .country-item:hover, .operator-item:hover {
            background: var(--light);
        }
        
        .service-item.selected, .country-item.selected, .operator-item.selected {
            background: rgba(67, 97, 238, 0.1);
            color: var(--primary);
        }
        
        .service-info, .country-info, .operator-info {
            display: flex;
            align-items: center;
            flex: 1;
        }
        
        .service-icon-small, .country-flag-small, .operator-icon-small {
            width: 24px;
            height: 24px;
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .country-flag-small img {
            width: 100%;
            height: 100%;
            border-radius: 2px;
            object-fit: cover;
        }
        
        .service-name, .country-name, .operator-name {
            font-weight: 500;
            flex: 1;
        }
        
        .service-numbers, .country-numbers, .operator-numbers {
            color: var(--gray);
            font-size: 0.9rem;
            margin-right: 10px;
        }
        
        .service-price, .country-price, .operator-price {
            color: var(--success);
            font-weight: 600;
            min-width: 60px;
            text-align: right;
        }

        .price-range {
            color: var(--success);
            font-weight: 600;
            font-size: 0.85rem;
        }
        
        /* 获取号码按钮 */
        .get-number-btn {
            width: 100%;
            padding: 15px;
            font-size: 1.1rem;
            font-weight: 600;
            margin-top: 20px;
        }
        
        /* 右侧面板样式 */
        .service-details {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .service-tabs {
            display: flex;
            border-bottom: 1px solid var(--light-gray);
            margin-bottom: 25px;
        }
        
        .tab {
            padding: 12px 25px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            font-weight: 500;
        }
        
        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* 主页内容 */
        .service-info-card {
            background: var(--light);
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 25px;
        }
        
        .service-info-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .service-info-icon {
            width: 80px;
            height: 80px;
            border-radius: 16px;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 20px;
            color: var(--primary);
            font-size: 2.5rem;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
        }
        
        .service-info-text {
            flex: 1;
        }
        
        .service-info-name {
            font-weight: 700;
            font-size: 1.8rem;
            margin-bottom: 5px;
        }
        
        .service-info-description {
            color: var(--gray);
            font-size: 1rem;
        }
        
        .service-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .service-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .feature-card {
            background: var(--light);
            border-radius: 8px;
            padding: 25px;
            text-align: center;
            transition: transform 0.3s;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
        }
        
        .feature-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            color: white;
            font-size: 1.5rem;
        }
        
        .feature-card h3 {
            margin-bottom: 10px;
            font-size: 1.2rem;
        }
        
        .feature-card p {
            color: var(--gray);
            font-size: 0.95rem;
            line-height: 1.5;
        }
        
        /* FAQ内容 */
        .faq-list {
            max-width: 800px;
        }
        
        .faq-item {
            margin-bottom: 20px;
            border: 1px solid var(--light-gray);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .faq-question {
            padding: 20px;
            background: var(--light);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
        }
        
        .faq-answer {
            padding: 20px;
            background: white;
            display: none;
        }
        
        .faq-item.active .faq-answer {
            display: block;
        }
        
        /* API内容 */
        .api-section {
            max-width: 800px;
        }
        
        .api-docs {
            background: var(--light);
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 25px;
        }
        
        .api-endpoint {
            background: white;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid var(--primary);
        }
        
        .endpoint-method {
            display: inline-block;
            padding: 4px 8px;
            background: var(--primary);
            color: white;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-right: 10px;
        }
        
        .endpoint-url {
            font-family: monospace;
            font-size: 0.95rem;
        }
        
        /* 购买指南 */
        .purchase-steps {
            max-width: 800px;
        }
        
        .step {
            display: flex;
            margin-bottom: 30px;
        }
        
        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            margin-right: 20px;
            flex-shrink: 0;
        }
        
        .step-content {
            flex: 1;
        }
        
        .step-content h3 {
            margin-bottom: 10px;
            font-size: 1.2rem;
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            .dashboard-layout {
                flex-direction: column;
            }
            
            .left-panel {
                width: 100%;
            }
            
            .service-stats, .service-features {
                grid-template-columns: 1fr;
            }
        }

      /* 隐藏国家和运营商的价格和数量显示 */
.country-numbers, 
.country-price {
    display: none;
}

/* 运营商价格样式 */
.operator-price {
    display: block;
    color: var(--success);
    font-weight: 600;
    min-width: 60px;
    text-align: right;
    font-size: 0.95rem;
}

/* 隐藏运营商的数量显示 */
.operator-numbers {
    display: none;
}

        /* === 价格计算区域样式 === */
.price-calculation {
    background: var(--light);
    border-radius: 8px;
    padding: 15px;
    margin-top: 20px;
    border-left: 4px solid var(--primary);
    text-align: center;
}

.total-price {
    font-weight: 600;
    font-size: 1.2rem;
    color: var(--primary);
}

/* 隐藏原来的价格项 */
.price-item {
    display: none;
}

        /* 在现有的CSS最后添加这些样式 */

/* API密钥模态框样式 */
.api-key-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 10000;
    align-items: center;
    justify-content: center;
}

.api-key-modal-content {
    background: white;
    padding: 30px;
    border-radius: 10px;
    width: 90%;
    max-width: 500px;
    box-shadow: 0 5px 25px rgba(0,0,0,0.2);
}

.api-key-display {
    background: var(--light);
    padding: 15px;
    border-radius: 6px;
    margin: 15px 0;
    word-break: break-all;
    font-family: monospace;
    border: 1px dashed var(--primary);
}

.api-key-warning {
    color: var(--danger);
    font-size: 0.9rem;
    margin: 10px 0;
}

        /* 钱包充值按钮样式 */
.wallet-recharge-btn .btn-primary {
    background: var(--primary);
    border: none;
    padding: 8px 15px;
    border-radius: 20px;
    font-weight: 500;
    transition: all 0.3s;
}

.wallet-recharge-btn .btn-primary:hover {
    background: var(--secondary);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(67, 97, 238, 0.3);
}

/* 支付选项悬停效果 */
.payment-option .payment-header:hover {
    background: rgba(67, 97, 238, 0.1) !important;
}

.crypto-option:hover, .card-option:hover, .bank-option:hover {
    border-color: var(--primary) !important;
    background: rgba(67, 97, 238, 0.05);
}

/* 下拉箭头动画 */
.payment-header i {
    transition: transform 0.3s;
}

.payment-header.active i {
    transform: rotate(180deg);
}

        /* 付款方式样式 */
.payment-container {
    max-width: 800px;
    margin: 0 auto;
}

.payment-header {
    text-align: center;
    margin-bottom: 40px;
}

.payment-header h2 {
    color: var(--primary);
    margin-bottom: 10px;
    font-size: 2rem;
}

.payment-header p {
    color: var(--gray);
    font-size: 1.1rem;
}

.payment-methods-grid {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.payment-method-card {
    background: white;
    border-radius: 12px;
    padding: 0;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    border: 2px solid transparent;
    transition: all 0.3s ease;
    overflow: hidden;
}

.payment-method-card:hover {
    border-color: var(--primary);
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(67, 97, 238, 0.15);
}

.payment-method-header {
    display: flex;
    align-items: center;
    padding: 25px;
    cursor: pointer;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-bottom: 1px solid var(--light-gray);
}

.method-icon {
    width: 60px;
    height: 60px;
    border-radius: 12px;
    background: var(--primary);
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 20px;
    color: white;
    font-size: 1.5rem;
}

.method-info {
    flex: 1;
}

.method-info h3 {
    margin-bottom: 5px;
    color: var(--dark);
    font-size: 1.3rem;
}

.method-info p {
    color: var(--gray);
    margin: 0;
}

.payment-method-header .fa-chevron-right {
    color: var(--gray);
    transition: transform 0.3s ease;
}

.payment-method-card.active .fa-chevron-right {
    transform: rotate(90deg);
    color: var(--primary);
}

.payment-method-details {
    display: none;
    padding: 0;
}

.payment-method-card.active .payment-method-details {
    display: block;
}

/* 加密货币选项 */
.crypto-options {
    padding: 20px;
}

.crypto-option {
    display: flex;
    align-items: center;
    padding: 20px;
    border: 2px solid var(--light-gray);
    border-radius: 10px;
    margin-bottom: 15px;
    cursor: pointer;
    transition: all 0.3s ease;
    background: white;
}

.crypto-option:hover {
    border-color: var(--primary);
    background: rgba(67, 97, 238, 0.05);
    transform: translateX(5px);
}

.crypto-option:last-child {
    margin-bottom: 0;
}

.crypto-icon {
    width: 50px;
    height: 50px;
    border-radius: 10px;
    background: linear-gradient(135deg, #ff6b35, #f7931a);
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 15px;
    color: white;
    font-size: 1.3rem;
}

.crypto-info h4 {
    margin-bottom: 5px;
    color: var(--dark);
}

.crypto-info p {
    color: var(--gray);
    margin: 0;
    font-size: 0.9rem;
}

/* 信用卡选项 */
.card-option {
    display: flex;
    align-items: center;
    padding: 25px;
    border: 2px solid var(--light-gray);
    border-radius: 10px;
    margin: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    background: white;
}

.card-option:hover {
    border-color: var(--primary);
    background: rgba(67, 97, 238, 0.05);
}

.card-icon {
    display: flex;
    gap: 10px;
    margin-right: 20px;
}

.card-icon i {
    font-size: 2rem;
}

.card-icon .fa-cc-visa {
    color: #1a1f71;
}

.card-icon .fa-cc-mastercard {
    color: #eb001b;
}

.card-info h4 {
    margin-bottom: 10px;
    color: var(--dark);
}

.fee-details {
    color: var(--gray);
}

.fee-details div {
    margin-bottom: 5px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.fee-details i {
    width: 16px;
    color: var(--primary);
}

/* 银行转账选项 */
.bank-options {
    padding: 20px;
}

.bank-option {
    display: flex;
    align-items: center;
    padding: 20px;
    border: 2px solid var(--light-gray);
    border-radius: 10px;
    margin-bottom: 15px;
    cursor: pointer;
    transition: all 0.3s ease;
    background: white;
}

.bank-option:hover {
    border-color: var(--primary);
    background: rgba(67, 97, 238, 0.05);
    transform: translateX(5px);
}

.bank-option:last-child {
    margin-bottom: 0;
}

.bank-icon {
    width: 50px;
    height: 50px;
    border-radius: 10px;
    background: linear-gradient(135deg, #28a745, #20c997);
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 15px;
    color: white;
    font-size: 1.3rem;
}

.bank-info h4 {
    margin-bottom: 10px;
    color: var(--dark);
}

        /* 付款覆盖层样式 */
/* 付款覆盖层样式 */
.payment-overlay {
    display: none;
    position: fixed;
    top: 80px; /* 从导航栏下方开始 */
    left: 0;
    width: 100%;
    height: calc(100% - 80px);
    background: rgba(0,0,0,0.7);
    z-index: 10000;
    overflow-y: auto;
}

.payment-overlay-content {
    background: white;
    min-height: 100%;
    border-radius: 12px 12px 0 0;
    padding: 30px 20px;
    margin: 0 auto;
    max-width: 1200px;
    box-shadow: 0 -5px 25px rgba(0,0,0,0.1);
}

.overlay-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
    padding-bottom: 15px;
    border-bottom: 1px solid var(--light-gray);
}

.close-overlay {
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: var(--gray);
    padding: 5px;
}

.close-overlay:hover {
    color: var(--danger);
}

        /* 支付选项手续费样式 */
.crypto-fee {
    margin-left: auto;
    padding: 4px 8px;
    background: var(--success);
    color: white;
    border-radius: 4px;
    font-size: 0.8rem;
    font-weight: 600;
}

/* 加密货币图标颜色 */
.crypto-icon.usdt {
    background: linear-gradient(135deg, #26A17B, #50AF95);
}

.crypto-icon.usdc {
    background: linear-gradient(135deg, #2775CA, #3A8CFF);
}

.crypto-icon.ethereum {
    background: linear-gradient(135deg, #627EEA, #8A92B2);
}

/* Pix图标样式 */
.pix-option {
    display: flex;
    align-items: center;
    padding: 25px;
    border: 2px solid var(--light-gray);
    border-radius: 10px;
    margin: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    background: white;
}

.pix-option:hover {
    border-color: var(--primary);
    background: rgba(67, 97, 238, 0.05);
}

.pix-icon {
    width: 50px;
    height: 50px;
    border-radius: 10px;
    background: linear-gradient(135deg, #32BB77, #28A745);
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 20px;
    color: white;
    font-size: 1.3rem;
}

/* 支付表单样式 */
.payment-form-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.8);
    z-index: 10001;
    align-items: center;
    justify-content: center;
}

.payment-form-container {
    background: white;
    border-radius: 12px;
    width: 90%;
    max-width: 500px;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 10px 40px rgba(0,0,0,0.3);
}

.payment-form-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 25px;
    border-bottom: 1px solid var(--light-gray);
}

.payment-form-content {
    padding: 25px;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: var(--dark);
}

.form-group input {
    width: 100%;
    padding: 12px 15px;
    border: 1px solid var(--light-gray);
    border-radius: 6px;
    font-size: 1rem;
    transition: border-color 0.3s;
}

.form-group input:focus {
    border-color: var(--primary);
    outline: none;
}

.form-row {
    display: flex;
    gap: 15px;
}

.form-row .form-group {
    flex: 1;
}

/* 加密货币选择样式 */
.crypto-selection {
    border: 1px solid var(--light-gray);
    border-radius: 6px;
    padding: 12px;
    background: var(--light);
    cursor: pointer;
}

.selected-crypto {
    display: flex;
    align-items: center;
    gap: 10px;
}

.crypto-icon-small {
    width: 24px;
    height: 24px;
    border-radius: 4px;
    background: var(--primary);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 0.8rem;
}

/* 钱包地址样式 */
.wallet-info {
    background: var(--light);
    padding: 20px;
    border-radius: 8px;
    margin: 20px 0;
}

.wallet-address {
    display: flex;
    align-items: center;
    background: white;
    padding: 12px;
    border-radius: 6px;
    margin: 10px 0;
}

.wallet-address code {
    flex: 1;
    font-family: monospace;
    font-size: 0.9rem;
}

.btn-copy {
    background: var(--primary);
    color: white;
    border: none;
    padding: 6px 12px;
    border-radius: 4px;
    cursor: pointer;
}

.warning-text {
    color: var(--danger);
    font-size: 0.9rem;
    margin: 10px 0 0;
}

/* 二维码样式 */
.qr-code-container {
    text-align: center;
    margin: 20px 0;
}

.qr-code-placeholder {
    width: 200px;
    height: 200px;
    border: 2px dashed var(--light-gray);
    border-radius: 8px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    margin: 0 auto;
    color: var(--gray);
}

.qr-code-placeholder i {
    font-size: 3rem;
    margin-bottom: 10px;
}

/* 按钮样式 */
.btn-confirm {
    width: 100%;
    padding: 15px;
    font-size: 1.1rem;
    margin-top: 20px;
}

.fee-calculation {
    background: var(--light);
    padding: 15px;
    border-radius: 6px;
    margin: 15px 0;
}

.fee-calculation p {
    margin: 5px 0;
    font-weight: 500;
}

        /* 语言切换器样式 */
.language-switcher {
    margin-right: 10px;
}

.language-dropdown {
    border: 1px solid var(--light-gray);
}

.language-option {
    padding: 10px 15px;
    cursor: pointer;
    transition: background-color 0.3s;
    color: var(--dark);
}

.language-option:hover {
    background-color: var(--light);
    color: var(--primary);
}

.language-option.active {
    background-color: rgba(67, 97, 238, 0.1);
    color: var(--primary);
    font-weight: 600;
}

        /* 在现有的CSS最后添加响应式样式 */

/* 平板设备 (768px 到 1024px) */
@media (max-width: 1024px) {
    .container {
        padding: 0 15px;
    }
    
    .dashboard-layout {
    display: flex;
    gap: 20px;
    margin-top: 20px;
    min-height: calc(100vh - 100px);
    align-items: flex-start; /* 确保左侧面板顶部对齐 */
}
    
    .left-panel {
        width: 300px;
    }
    
    .service-stats {
        grid-template-columns: repeat(2, 1fr);
    }
}

/* 手机设备 (小于 768px) */
@media (max-width: 768px) {
    .container {
        padding: 0 10px;
    }
    
    /* 导航栏适配 */
    .navbar {
        padding: 10px 0;
    }
    
    .logo {
        font-size: 1.2rem;
    }
    
    .nav-links {
        display: none; /* 在小屏幕上隐藏导航链接 */
    }
    
    /* 移动端菜单按钮 */
    .mobile-menu-btn {
        display: block;
        background: none;
        border: none;
        font-size: 1.5rem;
        color: var(--dark);
        cursor: pointer;
        padding: 5px;
    }
    
    /* 主布局改为垂直排列 */
    .dashboard-layout {
        flex-direction: column;
        gap: 10px;
        margin-top: 10px;
    }
    
    .left-panel {
        position: static; /* 取消固定定位 */
        max-height: none; /* 取消最大高度限制 */
        overflow-y: visible; /* 取消滚动 */
        top: auto; /* 重置顶部位置 */
    }
    
    /* 服务选择区域优化 */
    .panel-section {
        margin-bottom: 20px;
    }
    
    .services-list, .countries-list, .operators-list {
        max-height: 200px;
    }
    
    .service-item, .country-item, .operator-item {
        padding: 10px 12px;
    }
    
    /* 右侧面板优化 */
    .right-panel {
        padding: 20px 15px;
    }
    
    .service-tabs {
        flex-wrap: wrap;
    }
    
    .tab {
        padding: 10px 15px;
        font-size: 0.9rem;
    }
    
    .service-info-card {
        padding: 20px;
    }
    
    .service-info-header {
        flex-direction: column;
        text-align: center;
    }
    
    .service-info-icon {
        margin-right: 0;
        margin-bottom: 15px;
    }
    
    .service-stats {
        grid-template-columns: 1fr;
        gap: 15px;
    }
    
    .service-features {
        grid-template-columns: 1fr;
        gap: 15px;
    }
    
    .feature-card {
        padding: 20px;
    }
    
    /* 支付覆盖层手机适配 */
    .payment-overlay {
        top: 60px; /* 调整顶部位置 */
        height: calc(100% - 60px);
    }
    
    .payment-overlay-content {
        padding: 20px 15px;
        border-radius: 0;
    }
    
    .overlay-header {
        margin-bottom: 20px;
        padding-bottom: 10px;
    }
    
    .overlay-header h2 {
        font-size: 1.5rem;
    }
    
    /* 支付方法卡片手机适配 */
    .payment-method-header {
        padding: 20px;
    }
    
    .method-icon {
        width: 50px;
        height: 50px;
        margin-right: 15px;
    }
    
    .method-info h3 {
        font-size: 1.1rem;
    }
    
    .crypto-option, .card-option, .pix-option {
        padding: 15px;
        margin: 10px;
    }
    
    .crypto-icon, .bank-icon, .pix-icon {
        width: 40px;
        height: 40px;
        margin-right: 12px;
    }
    
    /* 支付表单手机适配 */
    .payment-form-container {
        width: 95%;
        max-width: none;
        margin: 10px;
        border-radius: 8px;
    }
    
    .payment-form-header {
        padding: 20px;
    }
    
    .payment-form-content {
        padding: 20px;
    }
    
    .form-row {
        flex-direction: column;
        gap: 0;
    }
    
    .qr-code-placeholder {
        width: 150px;
        height: 150px;
    }
    
    /* 移动端底部操作栏 */
    .mobile-bottom-bar {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: white;
        padding: 10px 15px;
        box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
        z-index: 1000;
    }
    
    .mobile-bottom-bar .btn {
        flex: 1;
        margin: 0 5px;
    }
    
    /* 语言切换器手机适配 */
    .language-switcher {
        margin-right: 5px;
    }
    
    .language-dropdown {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 80%;
        max-width: 200px;
    }
    
    /* 用户菜单手机适配 */
    .user-dropdown {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 80%;
        max-width: 250px;
    }
}

/* 小屏手机 (小于 480px) */
@media (max-width: 480px) {
    .container {
        padding: 0 8px;
    }
    
    .logo {
        font-size: 1.1rem;
    }
    
    .left-panel, .right-panel {
        padding: 12px;
    }
    
    .service-info-card {
        padding: 15px;
    }
    
    .feature-card {
        padding: 15px;
    }
    
    .payment-overlay-content {
        padding: 15px 10px;
    }
    
    .payment-method-header {
        padding: 15px;
    }
    
    .method-icon {
        width: 40px;
        height: 40px;
        margin-right: 12px;
    }
    
    .method-info h3 {
        font-size: 1rem;
    }
    
    .crypto-option, .card-option, .pix-option {
        padding: 12px;
        margin: 8px;
    }
    
    /* 更好的触摸目标 */
    .btn, .tab, .service-item, .country-item, .operator-item {
        min-height: 44px; /* 苹果推荐的最小触摸目标尺寸 */
    }
    
    .close-overlay, .close-form {
        min-width: 44px;
        min-height: 44px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
}

/* 横屏手机适配 */
@media (max-height: 500px) and (orientation: landscape) {
    .payment-overlay {
        top: 50px;
        height: calc(100% - 50px);
    }
    
    .payment-overlay-content {
        padding: 15px;
    }
    
    .payment-methods-grid {
        max-height: 60vh;
        overflow-y: auto;
    }
}

/* 防止移动端缩放 */
@viewport {
    width: device-width;
    zoom: 1.0;
}

/* 改善移动端滚动体验 */
html {
    -webkit-overflow-scrolling: touch;
}

body {
    -webkit-tap-highlight-color: transparent;
}

/* 支付表单关闭按钮优化 */
.close-overlay, .close-form {
    position: relative;
    z-index: 10001;
    background: rgba(0,0,0,0.1);
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.3s;
}

.close-overlay:hover, .close-form:hover {
    background: rgba(0,0,0,0.2);
}

/* 添加移动端专属的关闭区域 */
.mobile-close-area {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 60px;
    background: linear-gradient(to bottom, rgba(0,0,0,0.3), transparent);
    z-index: 9999;
    display: none;
}

@media (max-width: 768px) {
    .mobile-close-area {
        display: block;
    }
    
    .payment-overlay {
        top: 0;
        height: 100%;
    }
}

        /* 余额不足弹窗样式 */
.insufficient-balance-modal {
    animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

/* 确保价格显示正确 */
.price-range, .operator-price, .total-price {
    font-weight: 600;
    color: var(--success);
}

/* 删除价格前面的0 */
.price-range::before,
.operator-price::before,
.total-price::before {
    content: none;
}

        /* 隐藏服务数量显示 */
.service-numbers {
    display: none;
}

        /* 添加到现有的CSS中 */
.insufficient-balance-modal {
    animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.insufficient-balance-modal button {
    transition: all 0.3s ease;
}

.insufficient-balance-modal button:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}
        
    </style>
</head>
<body>
    <div class="mobile-close-area" id="mobileCloseArea" onclick="closePaymentOverlay()"></div>

    <!-- 导航栏 -->
    <header>
        <div class="container">
            <div class="navbar">
                <a href="dashboard.html" class="logo">
                    <i class="fas fa-sim-card"></i>
                    <span>7SIM</span>
                </a>
                  
              <div style="display: flex; align-items: center; gap: 15px;">
                  <!-- 语言切换按钮 - 新增 -->
                <div class="language-switcher" style="position: relative;">
                    <button class="btn btn-outline" id="languageSwitch" style="display: flex; align-items: center; gap: 8px; padding: 8px 15px;">
                        <i class="fas fa-globe"></i>
                        <span id="currentLanguage">中文</span>
                        <i class="fas fa-chevron-down" style="font-size: 0.8rem;"></i>
                    </button>
                    <div class="language-dropdown" id="languageDropdown" style="display: none; position: absolute; top: 100%; right: 0; background: white; box-shadow: 0 5px 15px rgba(0,0,0,0.1); border-radius: 8px; padding: 10px 0; min-width: 120px; z-index: 1000; margin-top: 5px;">
                        <div class="language-option" data-lang="zh">中文</div>
                        <div class="language-option" data-lang="en">English</div>
                    </div>
                </div>
    <!-- 钱包按钮 - 修复位置 -->
    <div class="wallet-recharge-btn" style="position: relative;">
        <button class="btn btn-primary" id="walletRechargeBtn" style="display: flex; align-items: center; gap: 8px; padding: 8px 15px;">
            <i class="fas fa-wallet"></i>
            <span id="balanceAmount">$0</span>
            <i class="fas fa-chevron-down" style="font-size: 0.8rem;"></i>
        </button>
    </div>
    
    <!-- 用户菜单 -->
    <div class="user-menu" style="position: relative;">
        <div class="user-avatar" id="userAvatar" style="width: 40px; height: 40px; border-radius: 50%; background: var(--light-gray); display: flex; align-items: center; justify-content: center; cursor: pointer;">
            <i class="fas fa-user"></i>
        </div>
        <div class="user-dropdown" id="userDropdown" style="display: none; position: absolute; top: 100%; right: 0; background: white; box-shadow: 0 5px 15px rgba(0,0,0,0.1); border-radius: 8px; padding: 10px 0; min-width: 200px; z-index: 1000; margin-top: 10px;">
            <!-- 用户下拉菜单内容保持不变 -->
        </div>
    </div>
</div>
    
   
</div>
            </div>
        </div>
    </header>

    <!-- 主内容区域 -->
    <div class="container main-content">
        <div class="dashboard-layout">
            <!-- 左侧面板 - 接码流程 -->
            <div class="left-panel">
                <div class="panel-section">
                    <h3>1. 选择服务</h3>
                    <div class="search-bar">
                        <i class="fas fa-search"></i>
                        <input type="text" id="serviceSearch" placeholder="寻找网站或者APP">
                    </div>
                    
                    <!-- 已选择的服务 -->
                    <div class="selected-item" id="selectedServiceItem" style="display: none;">
                        <div class="selected-item-content">
                            <div class="selected-item-icon" id="selectedServiceIcon">
                                <i class="fab fa-whatsapp"></i>
                            </div>
                            <div class="selected-item-name" id="selectedServiceName">WhatsApp</div>
                        </div>
                        <button class="remove-selection" id="removeServiceSelection">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div class="services-list" id="servicesList">
                        <!-- 服务列表会动态加载 -->
                    </div>
                </div>
                
                <div class="panel-section">
                    <h3>2. 选择国家</h3>
                    <div class="search-bar">
                        <i class="fas fa-search"></i>
                        <input type="text" id="countrySearch" placeholder="寻找国家">
                    </div>
                    
                    <!-- 已选择的国家 -->
                    <div class="selected-item" id="selectedCountryItem" style="display: none;">
                        <div class="selected-item-content">
                            <div class="selected-item-icon" id="selectedCountryIcon">
                                <img src="https://flagcdn.com/w40/gb.png" alt="英国" style="width: 100%; height: 100%; border-radius: 6px;">
                            </div>
                            <div class="selected-item-name" id="selectedCountryName">英国</div>
                        </div>
                        <button class="remove-selection" id="removeCountrySelection">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div class="countries-list" id="countriesList">
                        <!-- 国家列表会动态加载 -->
                    </div>
                </div>
                
                <div class="panel-section">
                    <h3>3. 选择运营商</h3>
                    <div class="operators-list" id="operatorsList">
                        <!-- 运营商列表会动态加载 -->
                    </div>
                </div>
                
               <div class="price-calculation" id="priceCalculation" style="display: none;">
    <div class="total-price">
        <span id="totalPriceValue">售价: $0.00</span>
    </div>
</div>
                
                <button class="btn btn-primary get-number-btn" id="getNumberBtn" disabled>获取号码</button>
            </div>
            
            <!-- 右侧面板 - 服务信息 -->
<div class="right-panel">
    <div class="service-details">
        <div class="service-tabs">
            <div class="tab active" data-tab="home">主页</div>
            <div class="tab" data-tab="faq">FAQ</div>
            <div class="tab" data-tab="api">API</div>
            <div class="tab" data-tab="purchase">怎么购买？</div>
        </div>
        
        <!-- 主页内容 -->
        <div class="tab-content active" id="home-tab">
            <div class="service-info-card">
                <div class="service-info-header">
                    <div class="service-info-icon" id="serviceMainIcon">
                        <i class="fas fa-sim-card"></i>
                    </div>
                    <div class="service-info-text">
                        <div class="service-info-name" id="serviceMainName">7SIM 虚拟号码服务</div>
                        <div class="service-info-description">用于接收短信和激活任何服务的虚拟号码</div>
                    </div>
                </div>
                
                <div class="service-stats">
                    <div class="stat-card">
                        <div class="stat-value">500,000+</div>
                        <div class="stat-label">手机号码在线</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">180+</div>
                        <div class="stat-label">国家/地区</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">24/7</div>
                        <div class="stat-label">全天候服务</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">$0.05</div>
                        <div class="stat-label">起价</div>
                    </div>
                </div>
                
                <div class="service-features">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-globe"></i>
                        </div>
                        <h3>全球覆盖</h3>
                        <p>有50多万个来自180个国家的手机号码同时在线，包括英国、美国、加拿大、泰国、印度尼西亚等</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-sync"></i>
                        </div>
                        <h3>实时更新</h3>
                        <p>天天添加新的虚拟号码，确保号码新鲜度和可用性</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <h3>价格实惠</h3>
                        <p>一个号码的价格从$0.05起，无需支付移动运营商月费</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-headset"></i>
                        </div>
                        <h3>24/7 客服支持</h3>
                        <p>客户支持提供24小时服务，通过聊天工具和社交网络解决所有问题</p>
                    </div>
                </div>
            </div>
            
            <div style="text-align: center; color: var(--gray); margin-top: 30px;">
                <p><strong>针对各个服务的价格限制来存钱！</strong></p>
                <p>天天添加新的虚拟号码，一个号码的价格从 $0.05 起，这样大家不必支付移动运营商的月费</p>
            </div>
        </div>
        
       <!-- FAQ内容 -->
<div class="tab-content" id="faq-tab">
    <h2 style="margin-bottom: 25px;">常见问题解答</h2>
    <div class="faq-list">
        <div class="faq-item">
            <div class="faq-question">
                什么是虚拟号码？
                <i class="fas fa-chevron-down"></i>
            </div>
            <div class="faq-answer">
                虚拟号码是一种在线电话号码，可以用于接收短信和验证码，但不需要实体SIM卡。它可以帮助您保护隐私，注册各种在线服务，避免使用个人真实手机号码。
            </div>
        </div>
        
        <div class="faq-item">
            <div class="faq-question">
                如何购买虚拟号码？
                <i class="fas fa-chevron-down"></i>
            </div>
            <div class="faq-answer">
                <ol>
                    <li>注册并登录您的7SIM账户</li>
                    <li>充值您的账户余额</li>
                    <li>选择需要的服务和国家</li>
                    <li>点击"获取号码"按钮</li>
                    <li>使用获取的号码接收短信</li>
                </ol>
            </div>
        </div>
        
        <div class="faq-item">
            <div class="faq-question">
                号码可以使用多久？
                <i class="fas fa-chevron-down"></i>
            </div>
            <div class="faq-answer">
                大多数号码的有效期为20分钟到24小时，具体取决于您选择的服务类型。在有效期内，您可以接收多条短信。超过有效期后号码将自动回收。
            </div>
        </div>
        
        <div class="faq-item">
            <div class="faq-question">
                支持哪些服务？
                <i class="fas fa-chevron-down"></i>
            </div>
            <div class="faq-answer">
                我们支持几乎所有主流服务，包括：<br>
                ✅ WhatsApp, Telegram, Facebook, Twitter<br>
                ✅ Instagram, Google, Amazon, TikTok<br>
                ✅ 微信, 支付宝, 淘宝, 京东<br>
                ✅ 以及数千种其他应用和网站
            </div>
        </div>
        
        <div class="faq-item">
            <div class="faq-question">
                如何充值账户？
                <i class="fas fa-chevron-down"></i>
            </div>
            <div class="faq-answer">
                我们支持多种支付方式：<br>
                • 虚拟货币支付<br>
                • 信用卡与借记卡<br>
                • 银行转账<br>
                登录后点击右上角的"充值"按钮即可进行充值。
            </div>
        </div>
        
        <div class="faq-item">
            <div class="faq-question">
                短信接收成功率如何？
                <i class="fas fa-chevron-down"></i>
            </div>
            <div class="faq-answer">
                我们的短信接收成功率超过95%。如果遇到接收失败的情况：<br>
                1. 可以尝试更换其他号码<br>
                2. 选择不同的国家/运营商<br>
                3. 联系客服寻求帮助
            </div>
        </div>
        
        <div class="faq-item">
            <div class="faq-question">
                是否支持API接口？
                <i class="fas fa-chevron-down"></i>
            </div>
            <div class="faq-answer">
                是的，我们提供完整的API接口支持，开发者可以通过API：<br>
                • 自动获取手机号码<br>
                • 接收短信内容<br>
                • 查询账户余额<br>
                • 管理使用记录<br>
                具体API文档请在"API"标签页查看。
            </div>
        </div>
        
        <div class="faq-item">
            <div class="faq-question">
                遇到问题如何联系客服？
                <i class="fas fa-chevron-down"></i>
            </div>
            <div class="faq-answer">
                我们提供24/7客服支持：<br>
                • 在线客服：登录后在右下角点击客服图标<br>
                • 邮箱支持：support@7sim.com<br>
                • 问题反馈：通过用户面板提交问题<br>
                平均响应时间：5-15分钟
            </div>
        </div>
    </div>
</div>
        
        <!-- API内容 -->
        <div class="tab-content" id="api-tab">
            <h2 style="margin-bottom: 25px;">API 文档</h2>
            <div class="api-section">
                <div class="api-docs">
                    <h3 style="margin-bottom: 15px;">面向开发者和用户的API</h3>
                    <p style="margin-bottom: 20px;">使用我们的API可以自动化获取号码和接收短信的过程。</p>
                    
                    <div class="api-endpoint">
                        <span class="endpoint-method">GET</span>
                        <span class="endpoint-url">/api/getNumber?service=whatsapp&country=us</span>
                    </div>
                    
                    <div class="api-endpoint">
                        <span class="endpoint-method">GET</span>
                        <span class="endpoint-url">/api/getSMS?number=+1234567890</span>
                    </div>
                    
                    <div class="api-endpoint">
                        <span class="endpoint-method">GET</span>
                        <span class="endpoint-url">/api/getBalance</span>
                    </div>
                </div>
                
                <p>在接码平台、高质量VPN/代理、浏览器的用户代理和可靠的软件的帮助下确保不间断运行</p>
            </div>
        </div>
        
        <!-- 购买指南 -->
        <div class="tab-content" id="purchase-tab">
            <h2 style="margin-bottom: 25px;">购买指南</h2>
            <div class="purchase-steps">
                <div class="step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <h3>充值账户</h3>
                        <p>首先需要充值您的账户余额。我们支持多种支付方式，包括支付宝、微信支付、信用卡等。</p>
                    </div>
                </div>
                <div class="step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <h3>选择服务</h3>
                        <p>在左侧面板选择您需要的服务，如WhatsApp、Telegram等。</p>
                    </div>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <h3>选择国家</h3>
                        <p>选择您需要的号码所在国家，不同国家的价格可能不同。</p>
                    </div>
                </div>
                <div class="step">
                    <div class="step-number">4</div>
                    <div class="step-content">
                        <h3>获取号码</h3>
                        <p>点击"获取号码"按钮，系统会为您分配一个可用的虚拟号码。</p>
                    </div>
                </div>
                <div class="step">
                    <div class="step-number">5</div>
                    <div class="step-content">
                        <h3>接收短信</h3>
                        <p>使用获取的号码注册服务，系统会自动接收并显示验证码短信。</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
    <script>
        // 用户菜单功能
        document.getElementById('userAvatar').addEventListener('click', function() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
        });

        // 更新用户下拉菜单信息
function updateUserDropdown() {
    const user = firebase.auth().currentUser;
    if (user) {
        // 先显示用户ID（后面getUserInfo会更新为缩短版本）
        document.getElementById('dropdownUserId').textContent = '加载中...';
        document.getElementById('dropdownBalance').textContent = '0.00';
        
        // 获取完整的用户信息（包括API Key和余额）
        getUserInfo(user.uid);
    }
}

        // 用户退出登录
        function userLogout() {
            if (confirm('确定要退出登录吗？')) {
                // 清除用户登录状态
                sessionStorage.removeItem('userLoggedIn');
                sessionStorage.removeItem('userData');
                window.location.href = 'index.html';
            }
        }

      // 服务数据 - 完全从 admin 页面添加
const servicesData = {
    services: [],  // 空数组，等待从 admin 添加
    countries: [], // 空数组，等待从 admin 添加
    operators: []  // 空数组，等待从 admin 添加
};

// 从 Firebase 加载平台数据
async function loadDataFromAdmin() {
    try {
        console.log('开始从 Firebase 加载平台数据...');
        
        // 1. 先尝试从 Firebase 加载
        const doc = await db.collection('platformData').doc('globalSettings').get();
        
        if (doc.exists) {
            const firebaseData = doc.data();
            console.log('从 Firebase 加载数据成功:', firebaseData);
            
            // 清空现有数据
            servicesData.services = [];
            servicesData.countries = [];
            servicesData.operators = [];
            
            // 加载国家数据
            if (firebaseData.countries && firebaseData.countries.length > 0) {
                console.log('从 Firebase 找到国家数据，数量:', firebaseData.countries.length);
                
                firebaseData.countries.forEach((country, index) => {
                    if (country.active !== false) {
                        servicesData.countries.push({
                            id: country.id,
                            name: country.name,
                            flag: country.flag
                        });
                    }
                });
            }
            
            // 加载服务数据
            if (firebaseData.services && firebaseData.services.length > 0) {
                console.log('从 Firebase 找到服务数据，数量:', firebaseData.services.length);
                
                firebaseData.services.forEach((service, index) => {
                    if (service.active !== false) {
                        servicesData.services.push({
                            id: service.id,
                            name: service.name,
                            icon: service.icon || 'fas fa-mobile-alt',
                            numbers: '0',
                            price: 0
                        });
                    }
                });
            }
            
            // 加载运营商数据
            if (firebaseData.operators && firebaseData.operators.length > 0) {
                console.log('从 Firebase 找到运营商数据，数量:', firebaseData.operators.length);
                
                firebaseData.operators.forEach((operator, index) => {
                    if (operator.active !== false) {
                        servicesData.operators.push({
                            id: operator.id,
                            name: operator.displayName || operator.name,
                            numbers: '0',
                            price: operator.multiplier,
                            multiplier: operator.multiplier
                        });
                    }
                });
            }
            
            // 加载价格规则
            if (firebaseData.pricingRules && firebaseData.pricingRules.length > 0) {
                console.log('从 Firebase 找到价格规则，数量:', firebaseData.pricingRules.length);
                localStorage.setItem('pricingRules', JSON.stringify(firebaseData.pricingRules));
            }
            
            // 更新本地存储作为备份
            localStorage.setItem('appData', JSON.stringify(firebaseData));
            
        } else {
            // 2. Firebase 没有数据，回退到本地存储
            console.log('Firebase 无数据，使用本地存储');
            loadFromLocalStorage();
        }
        
        console.log('数据加载完成:', {
            services: servicesData.services.length,
            countries: servicesData.countries.length,
            operators: servicesData.operators.length
        });
        
    } catch (error) {
        console.error('从 Firebase 加载数据失败，使用本地数据:', error);
        // 降级到本地存储
        loadFromLocalStorage();
    }
}

// 从本地存储加载数据的辅助函数
function loadFromLocalStorage() {
    const savedData = localStorage.getItem('appData');
    console.log('从 localStorage 读取的数据:', savedData);
    
    if (savedData) {
        try {
            const adminData = JSON.parse(savedData);
            
            // 清空现有数据
            servicesData.services = [];
            servicesData.countries = [];
            servicesData.operators = [];
            
            // 加载国家数据
            if (adminData.countries && adminData.countries.length > 0) {
                adminData.countries.forEach((country, index) => {
                    if (country.active !== false) {
                        servicesData.countries.push({
                            id: country.id,
                            name: country.name,
                            flag: country.flag
                        });
                    }
                });
            }
            
            // 加载服务数据
            if (adminData.services && adminData.services.length > 0) {
                adminData.services.forEach((service, index) => {
                    if (service.active !== false) {
                        servicesData.services.push({
                            id: service.id,
                            name: service.name,
                            icon: service.icon || 'fas fa-mobile-alt',
                            numbers: '0',
                            price: 0
                        });
                    }
                });
            }
            
            // 加载运营商数据
            if (adminData.operators && adminData.operators.length > 0) {
                adminData.operators.forEach((operator, index) => {
                    if (operator.active !== false) {
                        servicesData.operators.push({
                            id: operator.id,
                            name: operator.displayName || operator.name,
                            numbers: '0',
                            price: operator.multiplier,
                            multiplier: operator.multiplier
                        });
                    }
                });
            }
            
        } catch (error) {
            console.error('加载本地数据失败:', error);
        }
    } else {
        console.log('localStorage 中没有 appData 数据');
    }
}
         // 修复后的按中文拼音排序函数
function sortByPinyin(array, key = 'name') {
    return array.sort((a, b) => {
        // 添加空值检查
        const aValue = a[key] || '';
        const bValue = b[key] || '';
        
        // 如果都是空值，保持原顺序
        if (!aValue && !bValue) return 0;
        if (!aValue) return 1; // 空值排在后面
        if (!bValue) return -1; // 空值排在后面
        
        return aValue.localeCompare(bValue, 'zh-CN');
    });
}

        // 全局变量
        let selectedService = null;
        let selectedCountry = null;
        let selectedOperator = null;

       // 计算服务起价
function calculateServicePriceRange(serviceId) {
    const savedPricing = localStorage.getItem('pricingRules');
    let minPrice = 999;
    
    if (savedPricing) {
        try {
            const pricingRules = JSON.parse(savedPricing);
            const serviceRules = pricingRules.filter(rule => 
                rule.serviceId == serviceId && rule.active === true
            );
            
            serviceRules.forEach(rule => {
                if (rule.price < minPrice) minPrice = rule.price;
            });
        } catch (error) {
            console.error('解析价格规则失败:', error);
        }
    }
    
    // 如果没有找到价格规则，使用默认起价
    if (minPrice === 999) {
        minPrice = 0.05;
    }
    
    // 修复：显示"从$0.xx开始"的格式
    return `从$${minPrice.toFixed(2)}开始`;
}

               // 渲染服务列表 - 添加空值检查
function renderServices() {
    const servicesList = document.getElementById('servicesList');
    servicesList.innerHTML = '';
    
    if (servicesData.services.length === 0) {
        servicesList.innerHTML = '<div style="text-align: center; color: var(--gray); padding: 20px;">暂无服务，请在管理页面添加</div>';
        return;
    }
    
    // 过滤有效服务
    const validServices = servicesData.services.filter(service => 
        service && service.name
    );
    
    // 按拼音排序
    const sortedServices = sortByPinyin(validServices, 'name');
    
    sortedServices.forEach(service => {
        const priceRange = calculateServicePriceRange(service.id);
        
        const item = document.createElement('div');
        item.className = 'service-item';
        item.dataset.id = service.id;
        item.innerHTML = `
            <div class="service-info">
                <div class="service-icon-small">
                    <i class="${service.icon || 'fas fa-mobile-alt'}"></i>
                </div>
                <div class="service-name">${service.name}</div>
            </div>
            <div class="service-numbers">${service.numbers}</div>
            <div class="price-range">${priceRange}</div>  <!-- 移除前面的$符号 -->
        `;
        item.addEventListener('click', () => selectService(service));
        servicesList.appendChild(item);
    });
}
        
           // 渲染国家列表 - 修改版本
function renderCountries() {
    const countriesList = document.getElementById('countriesList');
    countriesList.innerHTML = '';
    
    if (servicesData.countries.length === 0) {
        countriesList.innerHTML = '<div style="text-align: center; color: var(--gray); padding: 20px;">' + 
            (currentLanguage === 'zh' ? '暂无国家，请在管理页面添加' : 'No countries available, please add in admin page') + 
            '</div>';
        return;
    }
    
    // 过滤掉没有名称的国家
    const validCountries = servicesData.countries.filter(country => 
        country && (country.name || country.displayName)
    );
    
    if (validCountries.length === 0) {
        countriesList.innerHTML = '<div style="text-align: center; color: var(--gray); padding: 20px;">没有有效的国家数据</div>';
        return;
    }
    
    // 使用displayName（经过翻译的名称）进行排序和显示
    const sortedCountries = sortByPinyin(validCountries, 'displayName');
    
    sortedCountries.forEach(country => {
        const displayName = country.displayName || country.name || '未知国家';
        const flagUrl = country.flag || 'https://flagcdn.com/w40/un.png';
        
        const item = document.createElement('div');
        item.className = 'country-item';
        item.dataset.id = country.id;
        item.innerHTML = `
            <div class="country-info">
                <div class="country-flag-small">
                    <img src="${flagUrl}" alt="${displayName}" onerror="this.src='https://flagcdn.com/w40/un.png'">
                </div>
                <div class="country-name">${displayName}</div>
            </div>
        `;
        item.addEventListener('click', () => selectCountry(country));
        countriesList.appendChild(item);
    });
}
        

       // 渲染运营商列表
function renderOperators() {
    const operatorsList = document.getElementById('operatorsList');
    operatorsList.innerHTML = '';
    
    if (servicesData.operators.length === 0) {
        operatorsList.innerHTML = '<div style="text-align: center; color: var(--gray); padding: 20px;">暂无运营商，请在管理页面添加</div>';
        return;
    }
    
    // 按拼音排序
    const sortedOperators = sortByPinyin(servicesData.operators, 'name');
    
    sortedOperators.forEach(operator => {
        // 计算该运营商的价格
        const operatorPrice = calculateOperatorPrice(operator);
        
        const item = document.createElement('div');
        item.className = 'operator-item';
        item.dataset.id = operator.id;
        item.innerHTML = `
            <div class="operator-info">
                <div class="operator-icon-small">
                    <i class="fas fa-sim-card"></i>
                </div>
                <div class="operator-name">${operator.name}</div>
            </div>
            <div class="operator-numbers">${operator.numbers}</div>
            <div class="operator-price">$${operatorPrice}</div>
        `;
        item.addEventListener('click', function() {
            selectOperator(operator, this);
        });
        operatorsList.appendChild(item);
    });
}

// 计算运营商价格
function calculateOperatorPrice(operator) {
    if (!selectedService || !selectedCountry) {
        return '';
    }
    
    // 查找对应的价格规则
    const priceRule = findPriceRule(selectedService.id, selectedCountry.id);
    let basePrice = 0;
    
    if (priceRule) {
        basePrice = priceRule.price;
    } else {
        // 如果没有找到价格规则，使用默认价格
        basePrice = 0.10;
    }
    
    // 根据选择的运营商计算最终价格
    const finalPrice = basePrice * operator.multiplier;
    // 修复：显示完整价格格式
    return `$${finalPrice.toFixed(2)}`;
}

      // 更新所有运营商的价格显示
function updateOperatorPrices() {
    document.querySelectorAll('.operator-item').forEach(item => {
        const operatorId = parseInt(item.dataset.id);
        const operator = servicesData.operators.find(op => op.id === operatorId);
        if (operator) {
            const price = calculateOperatorPrice(operator);
            const priceElement = item.querySelector('.operator-price');
            if (priceElement) {
                priceElement.textContent = price;
            }
        }
    });
}

        // 选择服务
function selectService(service) {
    selectedService = service;
    
    // 隐藏服务列表，显示已选择的服务
    document.getElementById('servicesList').style.display = 'none';
    document.getElementById('selectedServiceItem').style.display = 'flex';
    
    // 更新UI
    document.getElementById('selectedServiceIcon').innerHTML = `<i class="${service.icon}"></i>`;
    document.getElementById('selectedServiceName').textContent = service.name;
    
    // 更新运营商价格
    updateOperatorPrices();
    updatePriceCalculation();
    updateGetNumberButton();
}

       // 选择国家
function selectCountry(country) {
    selectedCountry = country;
    
    // 隐藏国家列表，显示已选择的国家
    document.getElementById('countriesList').style.display = 'none';
    document.getElementById('selectedCountryItem').style.display = 'flex';
    
    // 更新UI
    document.getElementById('selectedCountryIcon').innerHTML = `<img src="${country.flag}" alt="${country.name}" style="width: 100%; height: 100%; border-radius: 6px;">`;
    document.getElementById('selectedCountryName').textContent = country.name;
    
    // 更新运营商价格
    updateOperatorPrices();
    updatePriceCalculation();
    updateGetNumberButton();
}

        function selectOperator(operator, clickedElement) {
            selectedOperator = operator;
            
            // 更新UI
            document.querySelectorAll('.operator-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            if (clickedElement) {
                clickedElement.classList.add('selected');
            }
            
            updateGetNumberButton();
        }

// 计算最终价格
function calculateFinalPrice() {
    if (!selectedService || !selectedCountry || !selectedOperator) {
        return '0.00';
    }
    
    // 查找对应的价格规则
    const priceRule = findPriceRule(selectedService.id, selectedCountry.id);
    let basePrice = 0;
    
    if (priceRule) {
        basePrice = priceRule.price;
    } else {
        // 如果没有找到价格规则，使用默认价格
        basePrice = 0.10;
    }
    
    // 根据选择的运营商计算最终价格
    const finalPrice = basePrice * selectedOperator.multiplier;
    return finalPrice.toFixed(2); // 返回格式化后的字符串
}

function updatePriceCalculation() {
    const priceCalculation = document.getElementById('priceCalculation');
    
    if (selectedService && selectedCountry && selectedOperator) {
        priceCalculation.style.display = 'block';
        
        // 直接计算最终售价
        const finalPrice = calculateFinalPrice();
        // 修复：显示完整价格格式
        document.getElementById('totalPriceValue').textContent = `售价: $${finalPrice}`;
    } else {
        priceCalculation.style.display = 'none';
    }
}

        // 查找价格规则
        function findPriceRule(serviceId, countryId) {
            const savedPricing = localStorage.getItem('pricingRules');
            if (savedPricing) {
                try {
                    const pricingRules = JSON.parse(savedPricing);
                    return pricingRules.find(rule => 
                        rule.serviceId == serviceId && 
                        rule.countryId == countryId && 
                        rule.active === true
                    );
                } catch (error) {
                    console.error('解析价格规则失败:', error);
                }
            }
            return null;
        }

        // 更新获取号码按钮状态
        function updateGetNumberButton() {
            const getNumberBtn = document.getElementById('getNumberBtn');
            
            if (selectedService && selectedCountry && selectedOperator) {
                getNumberBtn.disabled = false;
            } else {
                getNumberBtn.disabled = true;
            }
        }

        // 移除服务选择
        function removeServiceSelection() {
            selectedService = null;
            document.getElementById('selectedServiceItem').style.display = 'none';
            document.getElementById('servicesList').style.display = 'block';
            document.getElementById('priceCalculation').style.display = 'none';
            updateGetNumberButton();
        }

        // 移除国家选择
        function removeCountrySelection() {
            selectedCountry = null;
            document.getElementById('selectedCountryItem').style.display = 'none';
            document.getElementById('countriesList').style.display = 'block';
            document.getElementById('priceCalculation').style.display = 'none';
            updateGetNumberButton();
        }

      // 获取号码
function getNumber() {
    if (!selectedService || !selectedCountry || !selectedOperator) {
        return;
    }
    
    const finalPrice = calculateFinalPrice();
    
    // 显示成功消息
    alert(`成功获取号码！\n服务: ${selectedService.name}\n国家: ${selectedCountry.name}\n运营商: ${selectedOperator.name}\n售价: $${finalPrice}`);
    
    // 这里可以添加实际的获取号码逻辑
}

        // ========== API Key 相关函数 - 在 setupEventListeners() 之前添加 ==========

// 生成API Key的函数
function generateApiKey() {
    const prefix = '7sim_';
    const randomPart = Math.random().toString(36).substr(2, 16);
    const timestamp = Date.now().toString(36);
    return prefix + randomPart + timestamp;
}

// 设置用户API Key
async function setupUserApiKey(user) {
    const userDoc = await db.collection('users').doc(user.uid).get();
    
    if (!userDoc.exists) {
        // 新用户，生成API Key
        const apiKey = generateApiKey();
        await db.collection('users').doc(user.uid).set({
            apiKey: apiKey,
            balance: 0,
            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
            isActive: true,
            apiCalls: 0,
            lastApiCall: null
        });
        console.log('新用户API Key已生成:', apiKey);
        return apiKey;
    } else {
        // 现有用户，返回现有API Key
        const userData = userDoc.data();
        console.log('现有用户API Key:', userData.apiKey);
        return userData.apiKey;
    }
}

// 获取用户信息（更新现有函数）
async function getUserInfo(userId) {
    try {
        const userDoc = await db.collection('users').doc(userId).get();
        if (userDoc.exists) {
            const userData = userDoc.data();
            
            // 更新余额
            document.getElementById('balanceAmount').textContent = `$${userData.balance || '0'}`;
            document.getElementById('dropdownBalance').textContent = (userData.balance || '0.00');
            
            // 存储API Key供后续使用
            window.userApiKey = userData.apiKey;
            
            // 更新用户ID显示（缩短显示）
            document.getElementById('dropdownUserId').textContent = userId.substring(0, 8) + '...';
        }
    } catch (error) {
        console.error('获取用户信息失败:', error);
    }
}

// 显示API密钥模态框
async function showApiKey() {
    const user = firebase.auth().currentUser;
    if (!user) return;
    
    // 确保有API Key
    if (!window.userApiKey) {
        await getUserInfo(user.uid);
    }
    
    document.getElementById('apiKeyValue').textContent = window.userApiKey || '未生成';
    document.getElementById('apiKeyModal').style.display = 'flex';
    
    // 关闭用户下拉菜单
    document.getElementById('userDropdown').style.display = 'none';
}

// 关闭API密钥模态框
function closeApiKeyModal() {
    document.getElementById('apiKeyModal').style.display = 'none';
}

// 复制API Key
function copyApiKey() {
    const apiKey = document.getElementById('apiKeyValue').textContent;
    navigator.clipboard.writeText(apiKey).then(() => {
        alert('API密钥已复制到剪贴板');
    }).catch(err => {
        console.error('复制失败:', err);
        alert('复制失败，请手动复制');
    });
}

// 重新生成API Key
async function regenerateApiKey() {
    if (!confirm('确定要重新生成API密钥吗？旧的密钥将立即失效！')) {
        return;
    }
    
    const user = firebase.auth().currentUser;
    if (!user) return;
    
    try {
        const newApiKey = generateApiKey();
        await db.collection('users').doc(user.uid).update({
            apiKey: newApiKey,
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        window.userApiKey = newApiKey;
        document.getElementById('apiKeyValue').textContent = newApiKey;
        
        alert('API密钥已重新生成！');
    } catch (error) {
        console.error('重新生成API密钥失败:', error);
        alert('操作失败，请重试');
    }
}

       // 修改 checkBalanceAndGetNumber 函数
async function checkBalanceAndGetNumber() {
    if (!selectedService || !selectedCountry || !selectedOperator) {
        alert(currentLanguage === 'zh' ? '请先选择服务、国家和运营商' : 'Please select service, country and operator first');
        return;
    }
    
    const user = firebase.auth().currentUser;
    if (!user) {
        alert(currentLanguage === 'zh' ? '请先登录' : 'Please login first');
        return;
    }
    
    try {
        const userDoc = await db.collection('users').doc(user.uid).get();
        if (!userDoc.exists) {
            alert(currentLanguage === 'zh' ? '用户信息不存在' : 'User information not found');
            return;
        }
        
        const userData = userDoc.data();
        const userBalance = userData.balance || 0;
        
        const requiredAmount = parseFloat(calculateFinalPrice());
        
        if (userBalance < requiredAmount) {
            // 余额不足，显示充值弹窗
            showInsufficientBalanceModal(userBalance, requiredAmount);
            return;
        }
        
        // 余额足够，执行获取号码操作
        getNumber();
        
    } catch (error) {
        console.error('检查余额失败:', error);
        alert(currentLanguage === 'zh' ? '检查余额失败，请重试' : 'Balance check failed, please try again');
    }
}

// 完善 showInsufficientBalanceModal 函数
function showInsufficientBalanceModal(currentBalance, requiredAmount) {
    const modalHtml = `
        <div class="insufficient-balance-modal" style="
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        ">
            <div style="
                background: white;
                padding: 30px;
                border-radius: 12px;
                max-width: 400px;
                width: 90%;
                text-align: center;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            ">
                <div style="font-size: 3rem; color: #e74c3c; margin-bottom: 15px;">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <h3 style="color: #e74c3c; margin-bottom: 15px;">
                    ${currentLanguage === 'zh' ? '余额不足' : 'Insufficient Balance'}
                </h3>
                <p style="margin-bottom: 10px;">
                    ${currentLanguage === 'zh' ? '当前余额' : 'Current Balance'}: 
                    <strong>$${currentBalance.toFixed(2)}</strong>
                </p>
                <p style="margin-bottom: 10px;">
                    ${currentLanguage === 'zh' ? '所需金额' : 'Required Amount'}: 
                    <strong>$${requiredAmount.toFixed(2)}</strong>
                </p>
                <p style="margin-bottom: 20px; color: #666;">
                    ${currentLanguage === 'zh' ? 
                        '您的余额不足，请先充值' : 
                        'Your balance is insufficient, please recharge first'}
                </p>
                <div style="display: flex; gap: 10px; justify-content: center;">
                    <button onclick="closeInsufficientBalanceModal()" style="
                        padding: 10px 20px;
                        border: 1px solid #ddd;
                        background: white;
                        border-radius: 6px;
                        cursor: pointer;
                        flex: 1;
                    ">${currentLanguage === 'zh' ? '取消' : 'Cancel'}</button>
                    <button onclick="goToRechargeFromModal()" style="
                        padding: 10px 20px;
                        background: #4361ee;
                        color: white;
                        border: none;
                        border-radius: 6px;
                        cursor: pointer;
                        flex: 1;
                    ">${currentLanguage === 'zh' ? '立即充值' : 'Recharge Now'}</button>
                </div>
            </div>
        </div>
    `;
    
    const modalContainer = document.createElement('div');
    modalContainer.id = 'insufficientBalanceModal';
    modalContainer.innerHTML = modalHtml;
    document.body.appendChild(modalContainer);
}

// 从余额不足弹窗跳转到充值
function goToRechargeFromModal() {
    closeInsufficientBalanceModal();
    showPaymentOverlay();
}

// 关闭余额不足弹窗
function closeInsufficientBalanceModal() {
    const modal = document.getElementById('insufficientBalanceModal');
    if (modal) {
        modal.remove();
    }
}

// 跳转到充值页面
function goToRecharge() {
    closeInsufficientBalanceModal();
    showPaymentOverlay();
}

       // 钱包充值按钮功能
// 钱包充值按钮功能 - 使用覆盖层方案
function setupWalletRecharge() {
    const walletRechargeBtn = document.getElementById('walletRechargeBtn');
    
    walletRechargeBtn.addEventListener('click', function() {
        showPaymentOverlay();
    });
    
    // 保留原有的付款卡片交互逻辑
    document.querySelectorAll('.payment-method-card').forEach(card => {
        const header = card.querySelector('.payment-method-header');
        
        header.addEventListener('click', function() {
            const isActive = card.classList.contains('active');
            
            document.querySelectorAll('.payment-method-card').forEach(c => {
                c.classList.remove('active');
            });
            
            if (!isActive) {
                card.classList.add('active');
            }
        });
    });
    
    // 具体支付选项点击事件
    document.querySelectorAll('.crypto-option, .card-option, .bank-option').forEach(option => {
        option.addEventListener('click', function(e) {
            e.stopPropagation();
            
            let methodName = '';
            if (this.classList.contains('crypto-option')) {
                const network = this.getAttribute('data-network');
                const coin = this.getAttribute('data-coin');
                methodName = `${network} ${coin}`;
            } else if (this.classList.contains('card-option')) {
                methodName = 'Credit Card - South Africa';
            } else if (this.classList.contains('bank-option')) {
                const bank = this.getAttribute('data-bank');
                methodName = bank === 'pix' ? 'Pix - Brazil' : 'PSE - Colombia';
            }
            
            alert(`您选择了: ${methodName}\n\n请稍后...支付功能正在开发中`);
        });
    });
}

// 显示付款覆盖层
function showPaymentOverlay() {
    document.getElementById('paymentOverlay').style.display = 'block';
    document.body.style.overflow = 'hidden'; // 防止背景滚动

    // 新增：移动端关闭区域显示
    const mobileCloseArea = document.getElementById('mobileCloseArea');
    if (mobileCloseArea) {
        mobileCloseArea.style.display = 'block';
    }
    // 新增：添加触摸事件监听防止滚动
    document.addEventListener('touchmove', preventScroll, { passive: false });
}

// 关闭付款覆盖层
function closePaymentOverlay() {
    // 保持您原有的代码
    document.getElementById('paymentOverlay').style.display = 'none';
    document.body.style.overflow = 'auto'; // 恢复滚动
    
    // 新增：隐藏移动端关闭区域
    const mobileCloseArea = document.getElementById('mobileCloseArea');
    if (mobileCloseArea) {
        mobileCloseArea.style.display = 'none';
    }
    // 新增：移除触摸事件监听
    document.removeEventListener('touchmove', preventScroll);
}

        function preventScroll(e) {
    e.preventDefault();
}

        // 设置列表事件监听器
function setupListEventListeners() {
    // 服务列表事件
    document.querySelectorAll('.service-item').forEach(item => {
        const serviceId = parseInt(item.dataset.id);
        const service = servicesData.services.find(s => s.id === serviceId);
        if (service) {
            item.addEventListener('click', () => selectService(service));
        }
    });
    
    // 国家列表事件
    document.querySelectorAll('.country-item').forEach(item => {
        const countryId = parseInt(item.dataset.id);
        const country = servicesData.countries.find(c => c.id === countryId);
        if (country) {
            item.addEventListener('click', () => selectCountry(country));
        }
    });
    
    // 运营商列表事件
    document.querySelectorAll('.operator-item').forEach(item => {
        const operatorId = parseInt(item.dataset.id);
        const operator = servicesData.operators.find(o => o.id === operatorId);
        if (operator) {
            item.addEventListener('click', function() {
                selectOperator(operator, this);
            });
        }
    });
}
       // 设置事件监听器
// 设置事件监听器（一次性设置）
function setupEventListeners() {
    // 移除选择事件
    document.getElementById('removeServiceSelection').addEventListener('click', removeServiceSelection);
    document.getElementById('removeCountrySelection').addEventListener('click', removeCountrySelection);
    
    // 获取号码按钮
    document.getElementById('getNumberBtn').addEventListener('click', checkBalanceAndGetNumber);
    
    // 标签切换功能
    document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', function() {
            // 移除所有active类
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            // 添加active类到当前标签
            this.classList.add('active');
            
            // 显示对应的内容
            const tabId = this.getAttribute('data-tab');
            const contentId = tabId + '-tab';
            const contentElement = document.getElementById(contentId);
            
            if (contentElement) {
                contentElement.classList.add('active');
            }
        });
    });
    
    // FAQ展开/收起
    document.querySelectorAll('.faq-question').forEach(question => {
        question.addEventListener('click', function() {
            const item = this.parentElement;
            item.classList.toggle('active');
        });
    });
    
    // 搜索功能
    document.getElementById('serviceSearch').addEventListener('input', function(e) {
        const searchTerm = e.target.value.toLowerCase();
        filterItems('servicesList', searchTerm);
    });

    document.getElementById('countrySearch').addEventListener('input', function(e) {
        const searchTerm = e.target.value.toLowerCase();
        filterItems('countriesList', searchTerm);
    });

    // 模态框事件监听
    const apiKeyModal = document.getElementById('apiKeyModal');
    if (apiKeyModal) {
        apiKeyModal.addEventListener('click', function(e) {
            if (e.target === this) {
                closeApiKeyModal();
            }
        });
    }
}
    
    // FAQ展开/收起
    document.querySelectorAll('.faq-question').forEach(question => {
        question.addEventListener('click', function() {
            const item = this.parentElement;
            item.classList.toggle('active');
        });
    });
    
    // 搜索功能
    document.getElementById('serviceSearch').addEventListener('input', function(e) {
        const searchTerm = e.target.value.toLowerCase();
        filterItems('servicesList', searchTerm);
    });

    document.getElementById('countrySearch').addEventListener('input', function(e) {
        const searchTerm = e.target.value.toLowerCase();
        filterItems('countriesList', searchTerm);
    });

    function filterItems(listId, searchTerm) {
        const items = document.getElementById(listId).querySelectorAll('.service-item, .country-item');
        
        items.forEach(item => {
            const text = item.textContent.toLowerCase();
            if (text.includes(searchTerm)) {
                item.style.display = 'flex';
            } else {
                item.style.display = 'none';
            }
        });
    }

    // 模态框事件监听
    const apiKeyModal = document.getElementById('apiKeyModal');
    if (apiKeyModal) {
        apiKeyModal.addEventListener('click', function(e) {
            if (e.target === this) {
                closeApiKeyModal();
            }
        });
    }



        // 设置 Firebase 实时数据同步
let currentDataHash = '';
function setupRealtimeSync() {
    // 监听 Firebase 数据变化
    db.collection('platformData').doc('globalSettings')
        .onSnapshot((doc) => {
            if (doc.exists) {
                const firebaseData = doc.data();
                
                // 生成数据哈希来检测真正的内容变化
                const newHash = generateDataHash(firebaseData);
                
                if (newHash !== currentDataHash) {
                    console.log('检测到云端数据真正更新，重新加载...');
                    currentDataHash = newHash;
                    
                    // 重新加载数据并渲染
                    loadDataFromAdmin().then(() => {
                        // 重新渲染界面但保留事件监听器
                        smartRerender();
                    });
                }
            }
        }, (error) => {
            console.error('实时同步错误:', error);
        });
}

// 生成数据哈希
function generateDataHash(data) {
    return JSON.stringify({
        services: data.services ? data.services.map(s => ({id: s.id, name: s.name})) : [],
        countries: data.countries ? data.countries.map(c => ({id: c.id, name: c.name})) : [],
        operators: data.operators ? data.operators.map(o => ({id: o.id, name: o.name})) : []
    });
}

// 智能重新渲染，不丢失事件监听器
function smartRerender() {
    // 保存当前选择状态
    const currentSelectedService = selectedService;
    const currentSelectedCountry = selectedCountry;
    const currentSelectedOperator = selectedOperator;
    
    // 重新渲染列表
    renderServices();
    renderCountries();
    renderOperators();
    updateOperatorPrices();
    
    // 恢复之前的选择状态
    if (currentSelectedService) {
        const serviceElement = document.querySelector(`.service-item[data-id="${currentSelectedService.id}"]`);
        if (serviceElement) {
            selectService(currentSelectedService);
        }
    }
    
    if (currentSelectedCountry) {
        const countryElement = document.querySelector(`.country-item[data-id="${currentSelectedCountry.id}"]`);
        if (countryElement) {
            selectCountry(currentSelectedCountry);
        }
    }
    
    if (currentSelectedOperator) {
        const operatorElement = document.querySelector(`.operator-item[data-id="${currentSelectedOperator.id}"]`);
        if (operatorElement) {
            selectOperator(currentSelectedOperator, operatorElement);
        }
    }
    
    // 重新设置事件监听器（确保新增的项目也有事件）
    setupListEventListeners();
}
        // ========== 多语言支持 ==========

// ========== 多语言支持 ==========

// 语言包 - 完整修复版本
const languagePack = {
    zh: {
        // 导航栏
        nav: {
            home: "主页",
            services: "服务",
            pricing: "价格",
            faq: "FAQ",
            api: "API"
        },
        
        // 左侧面板
        leftPanel: {
            selectService: "选择服务",
            searchService: "寻找网站或者APP",
            selectCountry: "选择国家", 
            searchCountry: "寻找国家",
            selectOperator: "选择运营商",
            getNumber: "获取号码"
        },
        
        // 右侧面板 - 标签页
        tabs: {
            home: "主页",
            faq: "FAQ", 
            api: "API",
            purchase: "怎么购买？"
        },
        
        // 主页内容
        home: {
            title: "7SIM 虚拟号码服务",
            description: "用于接收短信和激活任何服务的虚拟号码",
            numbersOnline: "手机号码在线",
            countries: "国家/地区",
            support: "全天候服务", 
            startingPrice: "起价",
            globalCoverage: "全球覆盖",
            realtimeUpdate: "实时更新",
            affordablePrice: "价格实惠",
            customerSupport: "24/7 客服支持",
            saveMoney: "针对各个服务的价格限制来存钱！",
            dailyUpdate: "天天添加新的虚拟号码，一个号码的价格从 $0.05 起，这样大家不必支付移动运营商的月费"
        },
        
        // FAQ
        faq: {
            title: "常见问题解答",
            questions: {
                whatIsVirtualNumber: "什么是虚拟号码？",
                howToBuy: "如何购买虚拟号码？",
                numberValidity: "号码可以使用多久？",
                supportedServices: "支持哪些服务？",
                howToRecharge: "如何充值账户？",
                successRate: "短信接收成功率如何？",
                apiSupport: "是否支持API接口？",
                contactSupport: "遇到问题如何联系客服？"
            }
        },
        
        // API
        api: {
            title: "API 文档",
            description: "面向开发者和用户的API",
            usage: "使用我们的API可以自动化获取号码和接收短信的过程。",
            note: "在接码平台、高质量VPN/代理、浏览器的用户代理和可靠的软件的帮助下确保不间断运行"
        },
        
        // 购买指南
        purchase: {
            title: "购买指南",
            steps: {
                recharge: "充值账户",
                selectService: "选择服务", 
                selectCountry: "选择国家",
                getNumber: "获取号码",
                receiveSMS: "接收短信"
            }
        },
        
        // 支付相关
        payment: {
            recharge: "充值",
            selectPayment: "选择付款方式",
            crypto: "加密货币",
            creditCard: "信用卡",
            bankTransfer: "银行转账",
            lowestFee: "最低手续费",
            minPayment: "最低付款金额"
        },
        
        // 通用
        common: {
            language: "中文",
            balance: "余额",
            logout: "退出登录",
            confirm: "确认",
            cancel: "取消",
            copy: "复制",
            close: "关闭"
        },
        
        // 余额不足提示
        balance: {
            insufficient: '余额不足',
            currentBalance: '当前余额',
            requiredAmount: '所需金额',
            insufficientMessage: '您的余额不足，请先充值',
            cancel: '取消',
            rechargeNow: '立即充值'
        }
    }, // zh 结束

    en: {
        // Navigation
        nav: {
            home: "Home",
            services: "Services", 
            pricing: "Pricing",
            faq: "FAQ",
            api: "API"
        },
        
        // Left Panel
        leftPanel: {
            selectService: "Select Service",
            searchService: "Find website or APP", 
            selectCountry: "Select Country",
            searchCountry: "Find country",
            selectOperator: "Select Operator", 
            getNumber: "Get Number"
        },
        
        // Right Panel - Tabs
        tabs: {
            home: "Home",
            faq: "FAQ",
            api: "API", 
            purchase: "How to Buy?"
        },
        
        // Home Content
        home: {
            title: "7SIM Virtual Number Service",
            description: "Virtual numbers for receiving SMS and activating any services",
            numbersOnline: "Phone Numbers Online",
            countries: "Countries/Regions", 
            support: "24/7 Support",
            startingPrice: "Starting Price",
            globalCoverage: "Global Coverage",
            realtimeUpdate: "Real-time Update", 
            affordablePrice: "Affordable Price",
            customerSupport: "24/7 Customer Support",
            saveMoney: "Save money with service-specific price limits!",
            dailyUpdate: "New virtual numbers added daily, starting from $0.05 per number, so you don't have to pay monthly fees to mobile operators"
        },
        
        // FAQ
        faq: {
            title: "Frequently Asked Questions",
            questions: {
                whatIsVirtualNumber: "What is a virtual number?",
                howToBuy: "How to buy virtual numbers?",
                numberValidity: "How long can numbers be used?",
                supportedServices: "Which services are supported?",
                howToRecharge: "How to recharge account?",
                successRate: "What is the SMS reception success rate?",
                apiSupport: "Is API interface supported?",
                contactSupport: "How to contact support if I have problems?"
            }
        },
        
        // API
        api: {
            title: "API Documentation", 
            description: "API for developers and users",
            usage: "Use our API to automate the process of getting numbers and receiving SMS.",
            note: "Ensure uninterrupted operation with the help of SMS platforms, high-quality VPNs/proxies, browser user agents, and reliable software"
        },
        
        // Purchase Guide
        purchase: {
            title: "Purchase Guide",
            steps: {
                recharge: "Recharge Account",
                selectService: "Select Service",
                selectCountry: "Select Country", 
                getNumber: "Get Number",
                receiveSMS: "Receive SMS"
            }
        },
        
        // Payment Related
        payment: {
            recharge: "Recharge",
            selectPayment: "Select Payment Method",
            crypto: "Cryptocurrency",
            creditCard: "Credit Card", 
            bankTransfer: "Bank Transfer",
            lowestFee: "Lowest Fee",
            minPayment: "Minimum Payment"
        },
        
        // Common
        common: {
            language: "English",
            balance: "Balance", 
            logout: "Logout",
            confirm: "Confirm",
            cancel: "Cancel",
            copy: "Copy",
            close: "Close"
        },
        
        // Balance
        balance: {
            insufficient: 'Insufficient Balance',
            currentBalance: 'Current Balance', 
            requiredAmount: 'Required Amount',
            insufficientMessage: 'Your balance is insufficient, please recharge first',
            cancel: 'Cancel',
            rechargeNow: 'Recharge Now'
        }
    } // en 结束
}; // languagePack 结束
// 当前语言
let currentLanguage = 'zh';

// 应用语言包
function applyLanguage(lang) {
    const texts = languagePack[lang];
    
    // 更新导航栏
    document.querySelectorAll('.nav-links a').forEach((link, index) => {
        const keys = Object.keys(texts.nav);
        if (texts.nav[keys[index]]) {
            link.textContent = texts.nav[keys[index]];
        }
    });
    
    // 更新左侧面板
    document.querySelectorAll('.panel-section h3').forEach((header, index) => {
        const keys = ['selectService', 'selectCountry', 'selectOperator'];
        if (texts.leftPanel[keys[index]]) {
            header.textContent = texts.leftPanel[keys[index]];
        }
    });
    
    document.getElementById('serviceSearch').placeholder = texts.leftPanel.searchService;
    document.getElementById('countrySearch').placeholder = texts.leftPanel.searchCountry;
    document.getElementById('getNumberBtn').textContent = texts.leftPanel.getNumber;
    
    // 更新标签页
    document.querySelectorAll('.tab').forEach((tab, index) => {
        const keys = Object.keys(texts.tabs);
        if (texts.tabs[keys[index]]) {
            tab.textContent = texts.tabs[keys[index]];
        }
    });
    
    // 更新主页内容
    const homeTexts = texts.home;
    document.getElementById('serviceMainName').textContent = homeTexts.title;
    document.querySelector('.service-info-description').textContent = homeTexts.description;
    
    document.querySelectorAll('.stat-label').forEach((label, index) => {
        const keys = ['numbersOnline', 'countries', 'support', 'startingPrice'];
        if (homeTexts[keys[index]]) {
            label.textContent = homeTexts[keys[index]];
        }
    });
    
    document.querySelectorAll('.feature-card h3').forEach((title, index) => {
        const keys = ['globalCoverage', 'realtimeUpdate', 'affordablePrice', 'customerSupport'];
        if (homeTexts[keys[index]]) {
            title.textContent = homeTexts[keys[index]];
        }
    });
    
    // 更新FAQ标题
    const faqTitle = document.querySelector('#faq-tab h2');
    if (faqTitle && texts.faq.title) {
        faqTitle.textContent = texts.faq.title;
    }
    
    // 更新API标题
    const apiTitle = document.querySelector('#api-tab h2');
    if (apiTitle && texts.api.title) {
        apiTitle.textContent = texts.api.title;
    }
    
    // 更新购买指南标题
    const purchaseTitle = document.querySelector('#purchase-tab h2');
    if (purchaseTitle && texts.purchase.title) {
        purchaseTitle.textContent = texts.purchase.title;
    }
    
    // 更新语言按钮
    document.getElementById('currentLanguage').textContent = texts.common.language;
}

// 更新语言按钮状态
function updateLanguageButton() {
    document.querySelectorAll('.language-option').forEach(option => {
        option.classList.remove('active');
        if (option.getAttribute('data-lang') === currentLanguage) {
            option.classList.add('active');
        }
    });
}

// 初始化语言设置
function initializeLanguage() {
    const savedLanguage = localStorage.getItem('preferredLanguage') || 'zh';
    switchLanguage(savedLanguage);
}

// 设置语言切换事件
function setupLanguageSwitcher() {
    const languageBtn = document.getElementById('languageSwitch');
    const languageDropdown = document.getElementById('languageDropdown');
    
    // 切换下拉菜单显示
    languageBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        languageDropdown.style.display = 
            languageDropdown.style.display === 'block' ? 'none' : 'block';
    });
    
    // 语言选项点击事件
    document.querySelectorAll('.language-option').forEach(option => {
        option.addEventListener('click', function() {
            const lang = this.getAttribute('data-lang');
            switchLanguage(lang);
            languageDropdown.style.display = 'none';
        });
    });
    
    // 点击页面其他区域关闭下拉菜单
    document.addEventListener('click', function() {
        languageDropdown.style.display = 'none';
    });
}

        // 核心国家翻译映射
const countryTranslations = {
    '中国': 'China',
    '美国': 'United States', 
    '英国': 'United Kingdom',
    '加拿大': 'Canada',
    '澳大利亚': 'Australia',
    '日本': 'Japan',
    '韩国': 'South Korea',
    '德国': 'Germany',
    '法国': 'France',
    '意大利': 'Italy',
    '西班牙': 'Spain',
    '俄罗斯': 'Russia',
    '巴西': 'Brazil',
    '印度': 'India',
    '泰国': 'Thailand',
    '越南': 'Vietnam',
    '马来西亚': 'Malaysia',
    '印度尼西亚': 'Indonesia',
    '菲律宾': 'Philippines',
    '新加坡': 'Singapore'
    // 可以继续添加更多常用国家...
};

// 智能翻译函数
function translateCountryName(countryName, targetLang) {
    if (targetLang === 'en') {
        // 中文 -> 英文
        return countryTranslations[countryName] || countryName;
    } else {
        // 英文 -> 中文（反向查找）
        const entry = Object.entries(countryTranslations).find(([zh, en]) => en === countryName);
        return entry ? entry[0] : countryName;
    }
}

// 修复语言切换功能
function switchLanguage(lang) {
    if (languagePack[lang]) {
        currentLanguage = lang;
        localStorage.setItem('preferredLanguage', lang);
        
        console.log('切换语言到:', lang);
        
        // 动态更新所有国家的显示名称
        if (servicesData.countries && servicesData.countries.length > 0) {
            servicesData.countries.forEach(country => {
                country.displayName = translateCountryName(country.name, lang);
            });
        }
        
        applyLanguage(lang);
        updateLanguageButton();
        
        // 重新渲染所有列表以更新显示
        renderCountries();
        renderServices();
        renderOperators();
        
        console.log('语言切换完成');
    }
}

// 修复应用语言函数
function applyLanguage(lang) {
    const texts = languagePack[lang];
    if (!texts) return;
    
    console.log('应用语言:', lang, texts);
    
    // 更新导航栏
    const navLinks = document.querySelectorAll('.nav-links a');
    if (navLinks.length > 0 && texts.nav) {
        const navKeys = Object.keys(texts.nav);
        navLinks.forEach((link, index) => {
            if (texts.nav[navKeys[index]]) {
                link.textContent = texts.nav[navKeys[index]];
            }
        });
    }
    
    
    // 更新左侧面板标题
    const panelHeaders = document.querySelectorAll('.panel-section h3');
    if (panelHeaders.length >= 3 && texts.leftPanel) {
        panelHeaders[0].textContent = texts.leftPanel.selectService || '选择服务';
        panelHeaders[1].textContent = texts.leftPanel.selectCountry || '选择国家';
        panelHeaders[2].textContent = texts.leftPanel.selectOperator || '选择运营商';
    }
    
    // 更新搜索框占位符
    const serviceSearch = document.getElementById('serviceSearch');
    const countrySearch = document.getElementById('countrySearch');
    const getNumberBtn = document.getElementById('getNumberBtn');
    
    if (serviceSearch && texts.leftPanel) {
        serviceSearch.placeholder = texts.leftPanel.searchService || '寻找网站或者APP';
    }
    if (countrySearch && texts.leftPanel) {
        countrySearch.placeholder = texts.leftPanel.searchCountry || '寻找国家';
    }
    if (getNumberBtn && texts.leftPanel) {
        getNumberBtn.textContent = texts.leftPanel.getNumber || '获取号码';
    }
    
    // 更新标签页
    const tabs = document.querySelectorAll('.tab');
    if (tabs.length >= 4 && texts.tabs) {
        const tabKeys = Object.keys(texts.tabs);
        tabs.forEach((tab, index) => {
            if (texts.tabs[tabKeys[index]]) {
                tab.textContent = texts.tabs[tabKeys[index]];
            }
        });
    }
    
    // 更新主页内容
    if (texts.home) {
        const serviceMainName = document.getElementById('serviceMainName');
        const serviceDescription = document.querySelector('.service-info-description');
        
        if (serviceMainName) serviceMainName.textContent = texts.home.title;
        if (serviceDescription) serviceDescription.textContent = texts.home.description;
        
        // 更新统计卡片
        const statLabels = document.querySelectorAll('.stat-label');
        if (statLabels.length >= 4) {
            const statKeys = ['numbersOnline', 'countries', 'support', 'startingPrice'];
            statLabels.forEach((label, index) => {
                if (texts.home[statKeys[index]]) {
                    label.textContent = texts.home[statKeys[index]];
                }
            });
        }
        
        // 更新特性卡片
        const featureTitles = document.querySelectorAll('.feature-card h3');
        if (featureTitles.length >= 4) {
            const featureKeys = ['globalCoverage', 'realtimeUpdate', 'affordablePrice', 'customerSupport'];
            featureTitles.forEach((title, index) => {
                if (texts.home[featureKeys[index]]) {
                    title.textContent = texts.home[featureKeys[index]];
                }
            });
        }
        
        // 更新底部文本
        const saveMoneyText = document.querySelector('.service-info-card + div p:first-child strong');
        const dailyUpdateText = document.querySelector('.service-info-card + div p:last-child');
        
        if (saveMoneyText && texts.home.saveMoney) {
            saveMoneyText.textContent = texts.home.saveMoney;
        }
        if (dailyUpdateText && texts.home.dailyUpdate) {
            dailyUpdateText.textContent = texts.home.dailyUpdate;
        }
    }
    
    // 更新FAQ标题
    if (texts.faq && texts.faq.title) {
        const faqTitle = document.querySelector('#faq-tab h2');
        if (faqTitle) faqTitle.textContent = texts.faq.title;
    }
    
    // 更新API标题
    if (texts.api && texts.api.title) {
        const apiTitle = document.querySelector('#api-tab h2');
        if (apiTitle) apiTitle.textContent = texts.api.title;
    }
    
    // 更新购买指南标题
    if (texts.purchase && texts.purchase.title) {
        const purchaseTitle = document.querySelector('#purchase-tab h2');
        if (purchaseTitle) purchaseTitle.textContent = texts.purchase.title;
    }
    
    // 更新语言按钮
    if (texts.common && texts.common.language) {
        const currentLanguageSpan = document.getElementById('currentLanguage');
        if (currentLanguageSpan) {
            currentLanguageSpan.textContent = texts.common.language;
        }
    }
}

// 修复语言按钮状态更新
function updateLanguageButton() {
    document.querySelectorAll('.language-option').forEach(option => {
        option.classList.remove('active');
        if (option.getAttribute('data-lang') === currentLanguage) {
            option.classList.add('active');
        }
    });
}

// 修复语言切换器设置
function setupLanguageSwitcher() {
    const languageBtn = document.getElementById('languageSwitch');
    const languageDropdown = document.getElementById('languageDropdown');
    
    if (!languageBtn || !languageDropdown) {
        console.error('语言切换器元素未找到');
        return;
    }
    
    // 切换下拉菜单显示
    languageBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        const isVisible = languageDropdown.style.display === 'block';
        languageDropdown.style.display = isVisible ? 'none' : 'block';
    });
    
    // 语言选项点击事件
    document.querySelectorAll('.language-option').forEach(option => {
        option.addEventListener('click', function(e) {
            e.stopPropagation();
            const lang = this.getAttribute('data-lang');
            console.log('选择语言:', lang);
            switchLanguage(lang);
            languageDropdown.style.display = 'none';
        });
    });
    
    // 点击页面其他区域关闭下拉菜单
    document.addEventListener('click', function() {
        languageDropdown.style.display = 'none';
    });
    
    console.log('语言切换器初始化完成');
}

// 在初始化时添加调试
function initializeLanguage() {
    const savedLanguage = localStorage.getItem('preferredLanguage') || 'zh';
    console.log('初始化语言:', savedLanguage);
    
    // 初始化国家显示名称
    if (servicesData.countries && servicesData.countries.length > 0) {
        servicesData.countries.forEach(country => {
            country.displayName = translateCountryName(country.name, savedLanguage);
        });
    }
    
    switchLanguage(savedLanguage);
}

        // 支付表单功能
function showPaymentForm(paymentType, paymentMethod) {
    // 隐藏所有表单
    document.querySelectorAll('.payment-form').forEach(form => {
        form.style.display = 'none';
    });
    
    // 显示对应的表单
    const formId = paymentType + 'Form';
    const form = document.getElementById(formId);
    if (form) {
        form.style.display = 'block';
    }
    
    // 更新标题
    const title = document.getElementById('paymentFormTitle');
    title.textContent = `${paymentMethod} - 支付`;
    
    // 显示表单
    document.getElementById('paymentFormOverlay').style.display = 'flex';
    document.body.style.overflow = 'hidden';
}

function closePaymentForm() {
    document.getElementById('paymentFormOverlay').style.display = 'none';
    document.body.style.overflow = 'auto';
}

// 复制功能
function copyWalletAddress() {
    const address = document.getElementById('walletAddress').textContent;
    navigator.clipboard.writeText(address).then(() => {
        alert('钱包地址已复制到剪贴板');
    });
}

function copyPixKey() {
    const key = document.getElementById('pixKey').textContent;
    navigator.clipboard.writeText(key).then(() => {
        alert('Pix密钥已复制到剪贴板');
    });
}

// 确认支付函数
function confirmCryptoPayment() {
    const amount = document.getElementById('cryptoAmount').value;
    if (!amount || amount < 0.4) {
        alert('请输入有效的充值金额（最低$0.4）');
        return;
    }
    alert(`加密货币支付确认！金额: $${amount}`);
    closePaymentForm();
}

function confirmCardPayment() {
    const amount = document.getElementById('cardAmount').value;
    if (!amount || amount < 0.4) {
        alert('请输入有效的充值金额（最低$0.4）');
        return;
    }
    alert(`信用卡支付确认！金额: $${amount}`);
    closePaymentForm();
}

function confirmPixPayment() {
    const amount = document.getElementById('pixAmount').value;
    if (!amount || amount < 0.4) {
        alert('请输入有效的充值金额（最低$0.4）');
        return;
    }
    alert(`Pix支付确认！金额: $${amount}\n请完成支付后等待确认。`);
    closePaymentForm();
}

// 更新支付选项点击事件
function setupPaymentOptions() {
    // 加密货币选项
    document.querySelectorAll('.crypto-option').forEach(option => {
        option.addEventListener('click', function() {
            const network = this.getAttribute('data-network');
            const coin = this.getAttribute('data-coin');
            showPaymentForm('crypto', `${network} ${coin}`);
        });
    });
    
    // 信用卡选项
    document.querySelectorAll('.card-option').forEach(option => {
        option.addEventListener('click', function() {
            showPaymentForm('card', 'Credit Card - South Africa');
        });
    });
    
    // Pix选项
    document.querySelectorAll('.pix-option').forEach(option => {
        option.addEventListener('click', function() {
            showPaymentForm('pix', 'Pix - Brazil');
        });
    });
}


        // 监听 admin 数据更新
        window.addEventListener('appDataUpdated', function() {
            console.log('检测到管理员数据更新，重新加载数据...');
            loadDataFromAdmin();
            renderServices();
            renderCountries();
            // 重置选择状态
            selectedService = null;
            selectedCountry = null;
            selectedOperator = null;
            document.getElementById('selectedServiceItem').style.display = 'none';
            document.getElementById('selectedCountryItem').style.display = 'none';
            document.getElementById('servicesList').style.display = 'block';
            document.getElementById('countriesList').style.display = 'block';
            document.getElementById('priceCalculation').style.display = 'none';
            updateGetNumberButton();
        });

        // 监听 localStorage 变化（多标签页同步）
        /*window.addEventListener('storage', function(e) {
            if (e.key === 'lastUpdate' || e.key === 'appData' || e.key === 'pricingRules') {
                console.log('检测到存储数据变化，重新加载数据...');
                loadDataFromAdmin();
                renderServices();
                renderCountries();
            }
        });*/

        // 监听页面可见性变化（当用户切换回这个标签页时检查更新）
       /* document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                // 页面变为可见时检查数据更新
                const lastUpdate = localStorage.getItem('lastUpdate');
                if (lastUpdate && lastUpdate !== window.lastDataUpdate) {
                    console.log('页面重新激活，检查数据更新...');
                    loadDataFromAdmin();
                    renderServices();
                    renderCountries();
                    window.lastDataUpdate = lastUpdate;
                }
            }
        });
        */

        // 初始化最后更新时间
        window.lastDataUpdate = localStorage.getItem('lastUpdate');
       // 初始化页面
// 初始化页面
document.addEventListener('DOMContentLoaded', async function() {
    console.log('Dashboard 页面加载完成，开始初始化...');
    
    try {
        // 先初始化语言系统
        initializeLanguage();
        setupLanguageSwitcher();
        
        updateUserDropdown();

        const user = firebase.auth().currentUser;
        if (user) {
            await setupUserApiKey(user);
        }
        
        // 加载数据
        await loadDataFromAdmin();
        
        // 数据加载后再次确保国家名称翻译正确
        if (servicesData.countries && servicesData.countries.length > 0) {
            servicesData.countries.forEach(country => {
                country.displayName = translateCountryName(country.name, currentLanguage);
            });
        }
        
        // 渲染界面
        renderServices();
        renderCountries();
        renderOperators();
        updateOperatorPrices();
        
        // 设置事件监听器
        setupEventListeners();
        setupListEventListeners(); // 新增这一行

        // 钱包充值功能
        setupWalletRecharge();
        setupPaymentOptions();  
        
        // 启动实时同步
        setupRealtimeSync();
        
        console.log('Dashboard 初始化完成');
        
    } catch (error) {
        console.error('Dashboard 初始化失败:', error);
    }
});
        
    </script>

     <!-- API密钥模态框 -->
<div class="api-key-modal" id="apiKeyModal">
    <div class="api-key-modal-content">
        <h3 style="margin-bottom: 20px;">您的API密钥</h3>
        <div class="api-key-display" id="apiKeyValue">
            加载中...
        </div>
        <div class="api-key-warning">
            <i class="fas fa-exclamation-triangle"></i>
            请妥善保管此密钥，不要泄露给他人！
        </div>
        <div style="display: flex; gap: 10px; margin-top: 20px;">
            <button class="btn btn-primary" onclick="copyApiKey()">
                <i class="fas fa-copy"></i> 复制密钥
            </button>
            <button class="btn btn-outline" onclick="regenerateApiKey()">
                <i class="fas fa-redo"></i> 重新生成
            </button>
            <button class="btn" onclick="closeApiKeyModal()" style="margin-left: auto;">
                关闭
            </button>
        </div>
    </div>
</div>

        <!-- 付款覆盖层 -->
<div class="payment-overlay" id="paymentOverlay">
    <div class="payment-overlay-content">
        <div class="container">
            <div class="overlay-header">
                <h2 style="margin: 0; color: var(--primary);">
                    <i class="fas fa-credit-card"></i> 账户充值
                </h2>
                <button class="close-overlay" onclick="closePaymentOverlay()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <!-- 这里放入您原来的付款内容 -->
            <div class="payment-container">
                <div class="payment-header">
                    <h2><i class="fas fa-credit-card"></i> 选择付款方式</h2>
                    <p>选择最适合您的付款方式来为账户充值</p>
                </div>
                
                <div class="payment-methods-grid">
                    <!-- 加密货币部分 -->
<div class="payment-method-card" data-method="crypto">
    <div class="payment-method-header">
        <div class="method-icon">
            <i class="fab fa-bitcoin"></i>
        </div>
        <div class="method-info">
            <h3>加密货币</h3>
            <p>使用主流加密货币支付</p>
        </div>
        <i class="fas fa-chevron-right"></i>
    </div>
    <div class="payment-method-details">
        <div class="crypto-options">
            <!-- TRC20 USDT -->
            <div class="crypto-option" data-network="TRC-20" data-coin="USDT" data-type="crypto">
                <div class="crypto-icon usdt">
                    <i class="fas fa-coins"></i>
                </div>
                <div class="crypto-info">
                    <h4>TRC-20 USDT</h4>
                    <p>Tether (TRC20 Network) - 手续费低，快速到账</p>
                </div>
                <div class="crypto-fee">
                    <span>手续费: 0%</span>
                </div>
            </div>
            
            <!-- TRC20 USDC -->
            <div class="crypto-option" data-network="TRC-20" data-coin="USDC" data-type="crypto">
                <div class="crypto-icon usdc">
                    <i class="fas fa-circle"></i>
                </div>
                <div class="crypto-info">
                    <h4>TRC-20 USDC</h4>
                    <p>USD Coin (TRC20 Network) - 完全抵押</p>
                </div>
                <div class="crypto-fee">
                    <span>手续费: 0%</span>
                </div>
            </div>
            
            <!-- ERC20 USDT -->
            <div class="crypto-option" data-network="ERC-20" data-coin="USDT" data-type="crypto">
                <div class="crypto-icon ethereum">
                    <i class="fab fa-ethereum"></i>
                </div>
                <div class="crypto-info">
                    <h4>ERC-20 USDT</h4>
                    <p>Tether (ERC20 Network) - 广泛支持</p>
                </div>
                <div class="crypto-fee">
                    <span>手续费: 0%</span>
                </div>
            </div>
            
            <!-- ERC20 USDC -->
            <div class="crypto-option" data-network="ERC-20" data-coin="USDC" data-type="crypto">
                <div class="crypto-icon usdc">
                    <i class="fab fa-ethereum"></i>
                </div>
                <div class="crypto-info">
                    <h4>ERC-20 USDC</h4>
                    <p>USD Coin (ERC20 Network) - 以太坊网络</p>
                </div>
                <div class="crypto-fee">
                    <span>手续费: 0%</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 信用卡部分 -->
<div class="payment-method-card" data-method="card">
    <div class="payment-method-header">
        <div class="method-icon">
            <i class="fas fa-credit-card"></i>
        </div>
        <div class="method-info">
            <h3>Credit Card - South Africa</h3>
            <p>使用VISA/MASTERCARD信用卡支付</p>
        </div>
        <i class="fas fa-chevron-right"></i>
    </div>
    <div class="payment-method-details">
        <div class="card-option" data-type="card" data-country="south-africa">
            <div class="card-icon">
                <i class="fab fa-cc-visa"></i>
                <i class="fab fa-cc-mastercard"></i>
            </div>
            <div class="card-info">
                <h4>South Africa Credit Card</h4>
                <div class="fee-details">
                    <div><i class="fas fa-percentage"></i> 手续费: 3.9% + $0.05</div>
                    <div><i class="fas fa-money-bill-wave"></i> 最低手续费: $0.05</div>
                    <div><i class="fas fa-hand-holding-usd"></i> 最低付款金额: $0.4</div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Pix支付部分 -->
<div class="payment-method-card" data-method="pix">
    <div class="payment-method-header">
        <div class="method-icon">
            <i class="fas fa-barcode"></i>
        </div>
        <div class="method-info">
            <h3>Pix - Brazil</h3>
            <p>巴西即时支付系统</p>
        </div>
        <i class="fas fa-chevron-right"></i>
    </div>
    <div class="payment-method-details">
        <div class="pix-option" data-type="pix" data-country="brazil">
            <div class="pix-icon">
                <i class="fas fa-qrcode"></i>
            </div>
            <div class="pix-info">
                <h4>Pix - Brazil</h4>
                <div class="fee-details">
                    <div><i class="fas fa-percentage"></i> 手续费: 3.75% + $0.35</div>
                    <div><i class="fas fa-money-bill-wave"></i> 最低手续费: $0.35</div>
                    <div><i class="fas fa-hand-holding-usd"></i> 最低付款金额: $0.4</div>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
                <!-- 支付表单覆盖层 -->
<div class="payment-form-overlay" id="paymentFormOverlay">
    <div class="payment-form-container">
        <div class="payment-form-header">
            <h2 id="paymentFormTitle">支付信息</h2>
            <button class="close-form" onclick="closePaymentForm()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="payment-form-content">
            <!-- 加密货币支付表单 -->
            <div class="payment-form" id="cryptoForm" style="display: none;">
                <div class="form-group">
                    <label>充值金额 (USD)</label>
                    <input type="number" id="cryptoAmount" placeholder="输入充值金额" min="0.4" step="0.01">
                </div>
                <div class="form-group">
                    <label>选择加密货币</label>
                    <div class="crypto-selection">
                        <div class="selected-crypto" id="selectedCrypto">
                            <div class="crypto-icon-small">
                                <i class="fas fa-coins"></i>
                            </div>
                            <span id="selectedCryptoText">请选择加密货币</span>
                        </div>
                    </div>
                </div>
                <div class="wallet-info">
                    <h4><i class="fas fa-wallet"></i> 收款钱包地址</h4>
                    <div class="wallet-address">
                        <code id="walletAddress">TBAf8JYpP3E7Lx5vQ2nR9mK6...</code>
                        <button class="btn-copy" onclick="copyWalletAddress()">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                    <p class="warning-text"><i class="fas fa-exclamation-triangle"></i> 请勿向此地址发送其他加密货币</p>
                </div>
                <div class="conversion-info">
                    <p>≈ <span id="cryptoEquivalent">0.000000</span> <span id="cryptoCurrency">USDT</span></p>
                </div>
                <button class="btn btn-primary btn-confirm" onclick="confirmCryptoPayment()">
                    <i class="fas fa-check"></i> 确认支付
                </button>
            </div>
            
            <!-- 信用卡支付表单 -->
            <div class="payment-form" id="cardForm" style="display: none;">
                <div class="form-group">
                    <label>充值金额 (USD)</label>
                    <input type="number" id="cardAmount" placeholder="输入充值金额" min="0.4" step="0.01">
                </div>
                <div class="fee-calculation">
                    <p>手续费: <span id="cardFee">$0.00</span></p>
                    <p>实际到账: <span id="cardNetAmount">$0.00</span></p>
                </div>
                <div class="form-group">
                    <label>持卡人姓名</label>
                    <input type="text" id="cardHolderName" placeholder="与卡片上姓名一致">
                </div>
                <div class="form-group">
                    <label>卡号</label>
                    <input type="text" id="cardNumber" placeholder="1234 5678 9012 3456" maxlength="19">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>有效期</label>
                        <input type="text" id="cardExpiry" placeholder="MM/YY" maxlength="5">
                    </div>
                    <div class="form-group">
                        <label>CVV</label>
                        <input type="text" id="cardCVV" placeholder="123" maxlength="4">
                    </div>
                </div>
                <div class="form-group">
                    <label>邮箱</label>
                    <input type="email" id="cardEmail" placeholder="接收收据的邮箱">
                </div>
                <button class="btn btn-primary btn-confirm" onclick="confirmCardPayment()">
                    <i class="fas fa-lock"></i> 安全支付
                </button>
            </div>
            
            <!-- Pix支付表单 -->
            <div class="payment-form" id="pixForm" style="display: none;">
                <div class="form-group">
                    <label>充值金额 (USD)</label>
                    <input type="number" id="pixAmount" placeholder="输入充值金额" min="0.4" step="0.01">
                </div>
                <div class="fee-calculation">
                    <p>手续费: <span id="pixFee">$0.00</span></p>
                    <p>实际到账: <span id="pixNetAmount">$0.00</span></p>
                </div>
                <div class="pix-qr-section">
                    <h4><i class="fas fa-qrcode"></i> Pix二维码</h4>
                    <div class="qr-code-container">
                        <div class="qr-code-placeholder">
                            <i class="fas fa-qrcode"></i>
                            <p>二维码加载中...</p>
                        </div>
                    </div>
                    <div class="pix-instructions">
                        <h5>支付说明:</h5>
                        <ol>
                            <li>打开您的银行APP</li>
                            <li>选择Pix支付</li>
                            <li>扫描上方二维码</li>
                            <li>确认支付金额</li>
                            <li>完成支付</li>
                        </ol>
                    </div>
                </div>
                <div class="pix-key">
                    <label>Pix密钥 (备用)</label>
                    <div class="pix-key-value">
                        <code id="pixKey">00020126580014br.gov.bcb.pix0136a5a6c8d9-e0f1-2345-6789-abc123def456</code>
                        <button class="btn-copy" onclick="copyPixKey()">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>
                <button class="btn btn-primary btn-confirm" onclick="confirmPixPayment()">
                    <i class="fas fa-check"></i> 我已支付
                </button>
            </div>
        </div>
    </div>
</div>
<!-- 最新更新 -->
                <!--Start of Tawk.to Script-->
<script type="text/javascript">
var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
(function(){
var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
s1.async=true;
s1.src='https://embed.tawk.to/691402a868ca98195a7f3730/1j9r2kouh';
s1.charset='UTF-8';
s1.setAttribute('crossorigin','*');
s0.parentNode.insertBefore(s1,s0);
})();
</script>
<!--End of Tawk.to Script-->
</body>
</html>
